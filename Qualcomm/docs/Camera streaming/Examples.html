<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta content="text/html;charset=utf-8" http-equiv="Content-Type">
<style type="text/css">
table {
   border-collapse: collapse;
   border-width: 1px;
   border-spacing: 1px;
   border-color: transparent;
   margin: 16px 0;
   width: 100%;
}
th {
   background-color: #bbb; color: white;
}
td, th {
   border-style: solid;
   border-color: black;
   border-width: 1px;
   padding: 0 6px;
}
td p:first-child, th p:first-child {
   margin-top: 3px;
}
td p:last-child, th p:last-child {
   margin-bottom: 3px;
}

.smarkdoc {
  margin-left: 42px; margin-right: 42px;
  font-size: 13px;
  font-family: 'Lucida Grande', Geneva, Helvetica, Arial, sans-serif;
}

h1, h2, h3 { color: #3c4c6c; }
h1 {
  text-align: center;
  font-size: 200%;
/*    margin-left: -30px; */
  clear: both;
}
h2 {
  font-size: 160%;
  margin: 32px -40px 24px -42px;
  padding: 3px 24px 8px;
  border-bottom: 2px solid #5088c5;
  clear: both;
}
h3 {
  font-size: 130%;
  margin: 20px -4px 10px;
  padding: 4px;
  clear: both;
}
h4 {
  font-size: 110%;
  margin: 2em 0 1em;
}

pre {
  font-size: 90%;
  background-color: #f0f0f4; padding: 6px; border: 1px solid #d0d0ee;
  font-family: "Courier New", "Lucida Console", "Monaco", monospace;
}

.pre {
  font-size: 90%;
  padding: 6px;
  background-color: #f0f0f4;
  font-family: "Courier New", "Lucida Console", "Monaco", monospace;
}

code {
  font-size: 90%;
  font-family: "Courier New", "Lucida Console", "Monaco", monospace;
}

h3 code {
  font-size: 100%;
}

p {
  margin: 0.8em 0;
}
ul, ol {
  margin: 1em 0 1em 3em; padding: 0;
}
div.indent {
  margin: 0 3em;
}

a[href] {
  text-decoration: none;
  color: #2020b0;
}
a[href]:hover {
  border-bottom: 1px dotted #2030d0;
}

/* Smark Users Guide */

.codebox {
  padding: 0 1px;  margin-right:1px;
  border:1px solid #d0d0ee;
  background-color: #f0f0f4;
  font-weight: bold;
  font-family: "Courier New", "Lucida Console", "Monaco", monospace;
}

/* ================ Smark-specific classes ================ */

.indent {
  margin: 0 3em;
}

/*
|| Floats affect text flow but not block boundaries, so graphics in a DIV
|| would overlap floats if not for "clear: both"
*/
.diagram {
  margin: 18px 0;
  clear: both;
}

/* ASCII Art */

.art {
  margin-right: auto; margin-left: auto; /* center */
  font-family: Arial, Verdana, "Lucida Console", Monaco, monospace;
  font-weight: bold;
}
.art * {
   border-color: #543;
}
.art .dline, .art .drect {
   border-style: dotted;
}
.art .rect {
   -webkit-box-shadow: 0.2em 0.2em 0.3em rgba(0,0,0,0.3);
   -moz-box-shadow: 0.2em 0.2em 0.3em rgba(0,0,0,0.3);
   box-shadow: 0.2em 0.2em 0.2em #875;
   background-color: #f9faf4; /* #fafff4; #f8f8ec;  */
}
.art .nofx {
   background-color: #f9faf4;
}
.art .round {
   border-radius: 0.6em;
   -webkit-border-radius: 0.6em;
   -moz-border-radius: 0.6em;
}

/* .art .line {  -webkit-box-shadow: 0.1em 0.1em 0.2em rgba(0,0,0,0.3); } */

/* Sequence Charts */

.msc {
   font: 11px Verdana, Monaco, "Lucida Console";
   margin-left: auto; margin-right: auto;
   background-color: white;
   /* border: 1px solid #555; */  /* Useful for non-white pages */
}

/* Table of Contents */

.tocLevel {
  margin-left: 2em;
  font-weight: normal;
}
.tocLevel .tocLevel {
  font-size: 90%; /* ...of inherited font size */
  line-height: 150%; /* ...of font size */
}
.toc > .tocLevel {
  font-weight: bold;
  margin: 0.5em 0
}
.toc {
  column-count: 2; column-gap: 2em;
  -moz-column-count: 2; -moz-column-gap: 2em;
  -webkit-column-count: 2; -webkit-column-gap: 2em;
}

/* ordinary text content is in P elements */

td p:first-child, th p:first-child {
   margin-top: 3px;
}
td p:last-child, th p:last-child {
   margin-bottom: 3px;
}
li p:only-child {
  margin-top: 0;
  margin-bottom: 0;
}

/* ================ Print ================ */

@media print {

  @page {
    margin: 0.75in 0.75in;
    size: Letter;
    @bottom {
      content: counter(page);
      vertical-align: top;
      padding-top: 1em;
    }
  }
  h1 { text-align: center;
       margin: 3in 0 20px; }
  h2 { page-break-before: always; }
  h2 { string-set: section content() }
  .toc { margin: 3em -2em }
  .toc a::after {
     font-size: 10px;
     content: leader(' . ') "  " target-counter(attr(href), page);
  }
  table { page-break-inside: avoid; }
}

/* ================  Layout  ================ */
/*
 *  +------------------------+
 *  |         #header        |
 *  +----------+-------------+
 *  | #sidebar |  #content   |
 *  |          |             |
 *  +----------+-------------+
 *
 * CSS padding, border width, and border style (!) affect the actual height
 * (and in turn layout).
 */

#header {
  position: fixed;
  top: 0px;
  height: 32px;
  left: 0px;
  width: 100%;
  padding: 10px 10px 0 0;
}
#sidebar {
  position: fixed;
  top: 42px;
  bottom: 0px;
  left: 0px;
  min-width: 180px;
  overflow: auto;
  border: 1px solid transparent;
  border-width: 0 1px 0 1px;
  padding: 0px 5px 0px 5px;
}
#content {
  position: fixed;
  top: 60px;
  left: 200px;
  bottom: 0px;
  right: 0px;
  overflow: auto;
  -webkit-overflow-scrolling: touch;
  padding: 10px 20px;
  padding-top: 0;
}

/* ================  Styles  ================ */


body {
  font-family: "Lucida Grande", Helvetica, Arial, sans-serif;
  font-size: 16px;
}

#header {
  color: #fff;
  background: #555;
  text-align: center;
  font-size: 25px;
}

#sidebar {
  color: #000;
  background: #eee;
  border-right: 1px solid #bbb;
  text-align: left;
  font-size: 12px;
  line-height: 50%;
}

#sidebar h1 {
  margin: 0 0 0 0;
  border-left: 5px solid transparent;
  text-align: left;
  font-size: 12px;
  /*text-shadow: #fff 1px 0px;*/
  line-height: 1%;
}

#sidebar h2 {
  margin: 2px 0 8px 0;
  border-left: 5px solid transparent;
  text-align: center;
  font-size: 12px;
  /*text-shadow: #fff 1px 0px;*/
  line-height: 1%;
}



#content {
  margin: 0;
  font-size: 13px;
  line-height: 160%;
}

#content h1, #content h2 {
  border-bottom: 2px solid;
  font-size: 1.8em;
  font-weight: normal;
  margin: 2.0em 0px 1.3em 0px;
  padding-bottom: 0.6em;
  text-align: left;
}

#content h3 {
  color: #242220;
  font-size: 1.4em;
  font-weight: normal;
  margin: 2em 0px 0.8em 0px;
  text-shadow: #FFFFFF 0px 1px 1px;
}
#content h4 {
  font-size: 1.2em;
  font-weight: normal;
  margin: 2em 0px 0.5em 0px;
  text-shadow: #FFFFFF 0px 1px 1px;
}

a[href] {
  color: #05c;
  text-decoration: none;
}

#sidebar a {
  /*text-shadow:  1px 1px 2px #fff, -1px -1px #ddd;*/
  line-height: 40%;
}

pre, code {
  font-family: "Courier New", "Lucida Console", "Monaco", monospace;
  font-family: "Monaco", monospace;  font-size: 90%;
  background-color: #f8f8fa;
  border: 1px solid #e4e4ee;
  -webkit-border-radius: 2px;
  -moz-border-radius: 2px;
  border-radius: 2px;
  padding: 1px 0 0 1px;
}

pre {
  padding: 2px 4px;
}

table {
   border-collapse: collapse;
   border-width: 1px;
   border-spacing: 1px;
   border-color: transparent;
   margin: 16px 0;
   width: 100%;
}
th {
   background-color: #bbb; color: white;
}
td, th {
   border-style: solid;
   border-color: black;
   border-width: 1px;
   padding: 0 6px;
}

/* Highlight currently-selected sidebar link */

#sidebar a.thisfile {
  color: #557;
}

/* indentation */

#content {
   padding-left: 60px;
}
#content h1, 
#content h2, 
#content h3, h4 {
    margin-left: -30px;
}

h3 > code {
    font-size: 80%;
}

/* ================ Smark-specific classes ================ */

.indent {
  margin: 0 3em;
}

/*
|| Floats affect text flow but not block boundaries, so graphics in a DIV 
|| would overlap floats if not for "clear: both"
*/
.diagram {
  margin: 18px 0;
  clear: both;
}

/* ASCII Art */

.art {
  margin-right: auto; margin-left: auto; /* center */
  font-family: Arial, Verdana, "Lucida Console", Monaco, monospace;
  font-weight: bold;
}
.art * {
   border-color: #543;
}
.art .dline, .art .drect {
   border-style: dotted;
}
.art .rect {
   -webkit-box-shadow: 0.2em 0.2em 0.3em rgba(0,0,0,0.3);
   -moz-box-shadow: 0.2em 0.2em 0.3em rgba(0,0,0,0.3);
   box-shadow: 0.2em 0.2em 0.2em #875;
   background-color: #f9faf4; /* #fafff4; #f8f8ec;  */
}
.art .nofx {
   background-color: #f9faf4;
}
.art .round {
   border-radius: 0.6em;
   -webkit-border-radius: 0.6em;
   -moz-border-radius: 0.6em;
}

/* Sequence Charts */

.msc {
   font: 11px Verdana, Monaco, "Lucida Console"; 
   margin-left: auto; margin-right: auto;
   background-color: white;
   border: 1px solid #555;
}

/* Table of Contents */

.tocLevel {
  margin-left: 2em;
  font-weight: normal;
}
.tocLevel .tocLevel {
  font-size: 90%; /* ...of inherited font size */
  line-height: 150%; /* ...of font size */
}
/*
.toc > .tocLevel {
  font-weight: bold;
  margin: 0.5em 0
}
*/

.toc {
  column-count: 1; column-gap: 2em;
  -moz-column-count: 1; -moz-column-gap: 2em;
  -webkit-column-count: 1; -webkit-column-gap: 2em; 
   alternate: column-width: 235px; column-rule-width: 5px;
}


.columns {
  column-count: 2; column-gap: 2em;
  -moz-column-count: 2; -moz-column-gap: 2em;
  -webkit-column-count: 2; -webkit-column-gap: 2em; p
}

/* ordinary text content is in P elements */

td p:first-child, th p:first-child {
   margin-top: 3px;
}
td p:last-child, th p:last-child {
   margin-bottom: 3px;
}
li p:only-child {
  margin-top: 0;
  margin-bottom: 0;
}


/* ================ Print ================ */

@media print {

  #header, #content { position: static; }
  #sidebar { display: none; }

  @page {
    margin: 0.75in 0.75in;
    size: Letter;
    @bottom {
      content: counter(page);
      vertical-align: top;
      padding-top: 1em;
    }
  }
  h1 { text-align: center;
       margin: 1in 0 1in; }
  h2 { page-break-before: always; }
  h2 { string-set: section content() }
  .toc { margin: 3em 0 }
  .toc a::after {
     font-size: 10px;
     content: leader(' . ') "  " target-counter(attr(href), page);
  }
  table { page-break-inside: avoid; }
}


</style><style type="text/css">
.search { right: 20pt; position: fixed; top: 5pt }

</style><title>Camera streaming examples</title>
</head><body>
<div class="smarkdoc"><div id="header">Hexagon SDK 3.4.3</div><div id="sidebar"><top><img src="../images/sidebar_top.jpg"></top><script src="../scripts/post.js" type="text/javascript"></script><form class="search" id="searchForm"><input id="searchquery" name="q" onkeydown="postFunctionKeydown(event, true)"><input id="searchButton" onclick="postFunction(true)" type="button" value="Search"></form><p>
<a href="../index.html">Quick start</a>
</p><hr>
<p>
<a href="../feature_matrix.html">Feature Matrix</a>
</p><hr>
<p>
<a href="../hexagon_architecture.html">Hexagon Architecture</a>
</p><hr>
<p>
<a href="../images/Hexagon_Document_Bundle.pdf#page=2881">Hexagon Compiler/Linker</a>
</p><hr>
<p>
<a href="../hexagon_libraries.html">Hexagon Standard Libraries</a>
</p><hr>
<p>
<a href="../images/80-VB419-178_QuRT_User_Guide.pdf">Hexagon RTOS</a>
</p><hr>
<p>
<a href="../images/80-VB419-108_Hexagon_DSP_User_Guide.pdf">Hexagon DSP Programming</a>
</p><hr>
<h3>
<a name="Platforms"></a>Platforms
</h3><p>
<a href="../Platforms_HLOS.html">HLOS</a>
</p><p>
<a href="../Platforms_Simulator.html">Simulator</a>
</p><p>
<a href="../Platforms_Target.html">Target</a>
</p><hr>
<h3>
<a name="Environments"></a>Environments
</h3><p>
<a href="../Environments_Build%20System.html">Build System</a>
</p><p>
<a href="../Environments_Build%20System%20Porting.html">Build System Porting</a>
</p><p>
<a href="../Environments_Hexagon%20IDE.html">Hexagon IDE</a>
</p><hr>
<h3>
<a name="ArchitectureOverview"></a>ArchitectureOverview
</h3><p>
<a href="../HVX/ArchitectureOverview.html">HVX</a>
</p><hr>
<h3>
<a name="Applications"></a>Applications
</h3><p>
<a href="../Audio/Applications.html">Audio</a>
</p><p>
<a href="../Camera%20streaming/Applications.html">Camera streaming</a>
</p><p>
<a href="../Applications_Compute%20offload.html">Compute offload</a>
</p><p>
<a href="../FastCV/Applications_Computer%20Vision.html">Computer Vision</a>
</p><p>
<a href="../Neural%20Networks/Applications.html">Neural Networks</a>
</p><p>
<a href="../Voice/Applications.html">Voice</a>
</p><hr>
<h3>
<a name="APIs"></a>APIs
</h3><p>
<a href="../APIs_Async%20Message%20Queue.html">Async Message Queue</a>
</p><p>
<a href="../APIs_DSP%20Clk%20&amp;%20Rsrc%20Mgmt.html">DSP Clk &amp; Rsrc Mgmt</a>
</p><p>
<a href="../APIs_Dynamic%20Loading.html">Dynamic Loading</a>
</p><p>
<a href="../APIs_FastRPC.html">FastRPC</a>
</p><hr>
<h3>
<a name="Examples"></a>Examples
</h3><p>
<a href="../Audio/Examples.html">Audio</a>
</p><p>
<a href="../Camera%20streaming/Examples.html">Camera streaming</a>
</p><p>
<a href="../Examples_Common.html">Common</a>
</p><p>
<a href="../Examples_ComputeHVX.html">ComputeHVX</a>
</p><p>
<a href="../Examples_GeneralOverview.html">GeneralOverview</a>
</p><p>
<a href="../Neural%20Networks/Examples.html">Neural Networks</a>
</p><hr>
<h3>
<a name="Testing"></a>Testing
</h3><p>
<a href="../CAPIv2/Testing_CAPIv2%20Unit%20Tests.html">CAPIv2 Unit Tests</a>
</p><p>
<a href="../Testing_Eclipse%20Unit%20Tests.html">Eclipse Unit Tests</a>
</p><hr>
<h3>
<a name="Debugging"></a>Debugging
</h3><p>
<a href="../Debugging_Connect%20to%20Device.html">Connect to Device</a>
</p><p>
<a href="../Debugging_Exceptions.html">Exceptions</a>
</p><p>
<a href="../Debugging_Message%20Logging.html">Message Logging</a>
</p><p>
<a href="../Debugging_Simulator.html">Simulator</a>
</p><p>
<a href="../Debugging_Target.html">Target</a>
</p><hr>
<h3>
<a name="Tools"></a>Tools
</h3><p>
<a href="../Tools_Hexagon%20Tools%208.3.html">Hexagon Tools 8.3</a>
</p><p>
<a href="../Tools_IDL%20Compiler.html">IDL Compiler</a>
</p><p>
<a href="../Tools_On%20Target%20Profiling.html">On Target Profiling</a>
</p><p>
<a href="../Tools_Scripts.html">Scripts</a>
</p><p>
<a href="../Tools_Signing.html">Signing</a>
</p><p>
<a href="../Tools_UserGuides.html">UserGuides</a>
</p><p>
<a href="../Tools_Utilities.html">Utilities</a>
</p><hr>
<h3>
<a name="FAQ"></a>FAQ
</h3><p>
<a href="../FAQ_Common.html">Common</a>
</p><p>
<a href="../FAQ_Dynamic%20Loading.html">Dynamic Loading</a>
</p><p>
<a href="../FAQ_FastRPC.html">FastRPC</a>
</p><p>
<a href="../FAQ_Hexagon%20IDE.html">Hexagon IDE</a>
</p><hr>
<h3>
<a name="Dependencies"></a>Dependencies
</h3><p>
<a href="../Dependencies_Common.html">Common</a>
</p><hr>
<h3>
<a name="Release%20Notes"></a>Release Notes
</h3><p>
<a href="../Release%20Notes_Common.html">Common</a>
</p><hr>
<h3>
<a name="Support"></a>Support
</h3><p>
<a href="../Support_Contact.html">Contact</a>
</p><center><img src="../images/sidebar_bot.jpg"></center></div><div id="content"><a name="_top_" style="display:block;"></a><h1>
<a name="Camera%20streaming%20examples"></a>Camera streaming examples
</h1><div class="toc"><div class="tocLevel"><a href="#Overview">Overview</a></div><div class="tocLevel"><a href="#Goals">Goals</a></div><div class="tocLevel"><a href="#Example%20contents">Example contents</a><div class="tocLevel"><a href="#_Dependencies">Dependencies</a></div><div class="tocLevel"><a href="#File%20Structure">File Structure</a></div><div class="tocLevel"><a href="#hvx_add_constant%20example%20walk-through">hvx_add_constant example walk-through</a></div><div class="tocLevel"><a href="#Function%20naming%20conventions">Function naming conventions</a></div></div><div class="tocLevel"><a href="#Building%20examples">Building examples</a><div class="tocLevel"><a href="#Build%20OEM%20plugin:">Build OEM plugin:</a></div><div class="tocLevel"><a href="#Build%20QDSP6%20lib:">Build QDSP6 lib:</a></div></div><div class="tocLevel"><a href="#Load%20example%20to%20device">Load example to device</a></div><div class="tocLevel"><a href="#Running%20the%20examples">Running the examples</a></div><div class="tocLevel"><a href="#Collect%20Frame%20Dump">Collect Frame Dump</a></div><div class="tocLevel"><a href="#Debug%20and%20logging">Debug and logging</a></div><div class="tocLevel"><a href="#SDM845%20Camera%20Streaming">SDM845 Camera Streaming</a></div><div class="tocLevel"><a href="#Steps%20to%20verify%20Camera%20Streaming:">Steps to verify Camera Streaming:</a></div><div class="tocLevel"><a href="#Files%20in%20SDK">Files in SDK</a><div class="tocLevel"><a href="#Camera%20Streaming%20Framework">Camera Streaming Framework</a></div><div class="tocLevel"><a href="#Example:">Example:</a></div></div><div class="tocLevel"><a href="#OEM%20Plug-in:">OEM Plug-in:</a></div></div><h2>
<a name="Overview"></a>Overview
</h2><p>
Camera streaming examples includes hvx_add_constant. This simple examples shows how a developer would use the utilities provided by camera streaming framework to develop a camera streaming use case for Bayer pixel data processing.
</p><p>
Please make sure to have the dependencies ready before running examples on device. See [Dependencies].
</p><h2>
<a name="Goals"></a>Goals
</h2><p>
In general the goals for this example is to
</p><ul type="circle">
<li>
<p>
Show how to use the utilities provided by camera streaming framework
</p>
</li><li>
<p>
Provide programming model for developers.
</p>
</li><li>
<p>
Show different use cases that camera streaming usually handle
</p>
</li><li>
<p>
Using these examples as reference, developers can replace the processing portion of the code with their own, and quickly implement their own camera streaming use case.
</p>
</li>
</ul><p>
The add_constant example shows how application can pass runtime parameter from OEM plugin to QDSP6 lib, and how application can transmit and access buffers between Android and DSP.
</p><h2>
<a name="Example%20contents"></a>Example contents
</h2><h3>
<a name="_Dependencies"></a>Dependencies
</h3><ul type="circle">
<li>
<p>
Camera streaming example require DSP6 V60 and above.
</p>
</li><li>
<p>
Camera streaming example require Hexagon tools version 7.2.06 or above for compilation and simulation.
</p>
</li>
</ul><p>
All code-level dependencies are included in HexagonSDK.
</p><p>
QDSP6 lib's dependencies are at:
</p><pre>&lt;HexagonSDK root&gt;\&lt;version&gt;\lib\camera_streaming\framework
</pre><p>
This folder contains
</p><ul type="circle">
<li>
<p>
<b>adsp_hvx.h</b>: The fastrpc API for camera streaming module to call ADSP from ARM
</p>
</li><li>
<p>
<b>adsp_hvx_callback.h</b>: The fastrpc API for camera streaming module to callback to ARM
</p>
</li><li>
<p>
<b>adsp_hvx_common.h</b>: common data structures shared by camera streaming framework and QDSP6 lib
</p>
</li><li>
<p>
<b>adsp_hvx_process_utils.h</b>: utility functions to help streaming process to be in sync with ISP
</p>
</li><li>
<p>
<b>libadsp_hvx_skel.so</b>: binary for camera streaming framework on QDSP6 side
</p>
</li>
</ul><p>
OEM plugin's dependencies are at:
</p><pre>&lt;HexagonSDK root&gt;\&lt;version&gt;\lib\camera_streaming\framework_stub
</pre><p>
This folder contains
</p><ul type="circle">
<li>
<p>
<b>hvx_lib.h</b>: the API for OEM plugin to implement
</p>
</li>
</ul><p>
All dependency files are required to be present to build the examples.
</p><h3>
<a name="File%20Structure"></a>File Structure
</h3><p>
Two examples are provided with HexagonSDK release, both have OEM plugin and QDSP6 lib implementation. Structure-wise, both examples are similar, so we take &#8220;hvx_add_constant&#8221; as example for better explanation.
</p><p>
The OEM plugin implementation is at:
</p><pre>&lt;hexagonSDK root&gt;\&lt;version&gt;\examples\camera_streaming\hvx_add_constant_stub
</pre><p>
A single c source file is included:
</p><ul type="circle">
<li>
<p>
<b>hvx_add_constant.c</b> is implemented following hvx_lib.h
</p>
</li>
</ul><p>
The QDSP6 lib implementation is at:
</p><pre>&lt;hexagonSDK root&gt;\&lt;version&gt;\examples\camera_streaming\hvx_add_constant
</pre><p>
It contains a set of header, c source and asm source files to generate the shared library for streaming processing.
</p><ul type="circle">
<li>
<p>
<b>asm_src/add_constant.S</b> is the assembly file for add constant function. This file contains most of data processing
</p>
</li><li>
<p>
<b>inc/hvx_app_add_constant.h</b> is the header file for copy line function.
</p>
</li><li>
<p>
<b>inc/hvx_add_constant_def.h</b> is the header shares runtime parameter structure with user lib in Android side
</p>
</li><li>
<p>
<b>src/hvx_app_add_constant.c</b> is the c source code. This file contains most of the control logic
</p>
</li><li>
<p>
<b>hexagon.min</b> contains information required to build the DSP libraries and test executable. It may need to be modified if source files and/or dependencies are changed. See <a href="../Environments_Build%20System.html">Command line development environment</a> for more information
</p>
</li><li>
<p>
<b>Makefile</b> should not need to change. See <a href="../Environments_Build%20System.html">Command line development environment</a> for more information
</p>
</li>
</ul><p>
The camera streaming framework binary and header is at:
</p><pre style="font-size: 72%">&lt;hexagonSDK root&gt;\&lt;version&gt;\lib\camera_streaming\framework\ship\hexagon_Release_dynamic_toolv80_v60
</pre><ul type="circle">
<li>
<p>
<b>hvx_app_common.h</b> defines data structures shared between OEM plugin and QDSP6 lib.
</p>
</li>
</ul><p>
OEM plugin API and implementation could be updated in Android build release. Please always refer to Android build for latest version. Place to check in Android build:
</p><pre>&lt;platform&gt;/vendor/qcom/proprietary/mm-camerasdk/hvx
</pre><h3>
<a name="hvx_add_constant%20example%20walk-through"></a>hvx_add_constant example walk-through
</h3><p>
For each application, OEM plugin is responsible for configuring high-level HVX camera streaming parameters. This is done by hvx_lib_get_hvx_info function.
</p><ul type="circle">
<li>
<p>
<b>hvx_add_constant.c</b>: at line 38.
</p><p>
input to the function:
</p><p>
sensor_width and sensor_height: sensor output resolution, which is also HVX input resolution.
</p><p>
available_hvx_units and available_hvx_vector_mode: this is the hardware capability of HVX supported. This will always be 4 and 64 byte mode.
</p><p>
output user needs to specify:
</p><p>
hvx_enable: set to HVX_TRUE to enable HVX, set to HVX_FALSE to disable HVX.
</p><p>
algo_name: camera streaming framework will take this string and invoke corresponding algorithm in DSP side. Please refer to Naming Conventions for details.
</p><p>
hvx_out_width and hvx_out_height: unless this is a downscale application, always put the same value as sensor_width and sensor_height.
</p><p>
request_hvx_units and request_hvx_vector_mode: user needs to specify # of units and mode to use for this application
</p><p>
is_pix_intf_needed: set to HVX_TRUE if HVX should be connected to VFE.
</p><p>
is_dump_frame_needed: set to HVX_TRUE if ADSP &lt;-&gt; APPS buffer commnication is required
</p>
</li>
</ul><p>
Some more configurations will be done by QDSP6 lib by filling adsp_streamer_config_t strucutre.
</p><ul type="circle">
<li>
<p>
<b>hvx_app_common.h</b>: at line 191, adsp_streamer_config_t is defined.
</p>
</li><li>
<p>
<b>hvx_app_add_constant.c</b>: at line 42, user needs to implement this get_config function. Based on input information of frame width and height, availabe l2 size, rx/tx_line_size, user should determine following parameters:
</p><p>
rx_lines and tx_lines: number of lines in rx buffer and tx buffer. For each streamer, size of RX/TX buffer is determined by rx_lines<i>rx_line_size, tx_lines</i>tx_line_size. Sum of RX/TX buffer size should not exceed available_l2_size.
</p><p>
tx_min_start: this is number of lines present in RX before TX can start transmission.
</p><p>
dynamic_buf_size: size of shared data structure with OEM plugin, this buffer will be written into CX.
</p><p>
rx_pad_size and rx_pad_type: see HVX streaming data padding/stripping support section in <a href="Applications.html">Applications</a> page.
</p>
</li><li>
<p>
<b>hvx_app_common.h</b>: at line 214, adsp_power_voting_t is defined.
</p><p>
The actual ADSP clk and bus BW are dependent on use case, so the clk voting are exposed to user.
</p><p>
please follow example in <b>hvx_app_add_constant.c</b> line 42 to fill in the structure.
</p><p>
mips_per_thread is usually one quarter of mips_total.
</p>
</li>
</ul><p>
The main frame processing function is implemented:
</p><ul type="circle">
<li>
<p>
<b>hvx_app_add_constant.c</b>: at line 113.
</p>
</li>
</ul><p>
hvx_add_constant example shows OEM plugin can send runtime parameter, camera streaming framework will store this piece of data in CX, QDSP6 lib can get the dynamic buffer using utility API. This buffer contains same data as user lib would send.
</p><p>
A common data structure is defined in both OEM plugin and QDSP6 lib for data sharing.
</p><ul type="circle">
<li>
<p>
<b>hvx_add_constant.c</b>: at line 22, a structure with single integer is defined.
</p>
</li><li>
<p>
<b>inc/hvx_add_constant_def.h</b>: at line 12, same structure is defined.
</p>
</li>
</ul><p>
OEM plugin can update parameters per frame and send these parameters as a strucutre to camera streaming framework. The framework will store the structure in CX, an API is provided to get the address of this structure.
</p><ul type="circle">
<li>
<p>
<b>hvx_add_constant.c</b>: at line 86, structure hvx_update_t is sent.
</p>
</li><li>
<p>
<b>hvx_app_add_constant.c</b>: at line 154, by calling process_util_get_dynamic_config_buf() API, user can get pointer to structure hvx_constant_t, which contains same information passed from OEM plugin, but this information is delayed by one frame.
</p>
</li>
</ul><ul type="circle">
<li>
<p>
<b>hvx_app_add_constant.c</b>: at line 276, user can use this runtime parameter
</p>
</li>
</ul><p>
hvx_add_constant example also shows frame buffer communication between ADSP and APPS.
</p><p>
QDSP6 lib can get buffer from ARM, write into it and send back to ARM. A buffer queue is implemented to facilitate the buffer management in camera streaming framework.
</p><p>
OEM plugin determins whether this application needs buffer.
</p><ul type="circle">
<li>
<p>
<b>hvx_add_constant.c</b>: at line 60, set hvx_info-&gt;is_dump_frame_needed to HVX_TRUE to enable buffer communication
</p>
</li>
</ul><p>
In OEM plugin, user also needs to define the size of buffer depending on use case.
</p><ul type="circle">
<li>
<p>
<b>hvx_add_constant.c</b>: at line 191.
</p><p>
user needs to implement hvx_lib_get_dump_buffer_size function
</p><p>
isp hvx interface software module will call this function, providing VFE frame structure
</p><p>
output_width and output_height are frame resolution
</p><p>
right_stripe_offset and overlap are dual-VFE parameters
</p><p>
dump_frame_size is the return value that indicates the size of buffer each streamer needs
</p><p>
if frame dump is the use case, dump_frame_size should be as large as frame size with padding
</p><p>
if stats collection is use case, dump_frame_size should depend on the amount of stats to be collected
</p>
</li>
</ul><p>
The filled buffer will be returned to hvx_lib_consume_dump method.
</p><ul type="circle">
<li>
<p>
<b>hvx_add_constant.c</b>: at line 97.
</p><p>
the example code will store the buffer into file system on device
</p><p>
it depends on user and use case how to handle these filled buffers
</p><p>
user should implement their own way of buffer handling
</p>
</li>
</ul><p>
A buffer queue is implemented within camera streaming framework to maintain internal buffer rotation scheme. QDSP6 lib is able to access to the buffers by dequeuing elements.
</p><ul type="circle">
<li>
<p>
<b>hvx_app_common.h</b>: at line 132 and line 138, buffer structure and buffer queue structure are defined.
</p>
</li><li>
<p>
<b>hvx_app_add_constant.c</b>: at line 265, user could dequeue a buffer and find buffer address and buffer label.
</p>
</li>
</ul><p>
After the buffer is filled, it will be send back to OEM plugin for furthur parsing.
</p><ul type="circle">
<li>
<p>
<b>hvx_app_add_constant.c</b>: at line 39, user should call hvx_event_queue_enqueue() API to send the buffer to Android. Buffer label and buffer address has 1 to 1 mapping. Enqueuing filled buffer label would inform streaming framework this buffer is filled.
</p>
</li>
</ul><h3>
<a name="Function%20naming%20conventions"></a>Function naming conventions
</h3><p>
Multiple OEM plugin libs and QDSP6 libs can exist in device at same time. A set of them uses a string to pair with each other. The naming of functions and libs should follow these conventions:
</p><ul type="circle">
<li>
<p>
<b>hvx_add_constant.c</b>: in implementation of hvx_lib_get_hvx_info, algo_name will be defined by user.
</p>
</li>
</ul><p>
Assuming this algo_name is &#8220;sample_algo&#8221;, then the QDSP6 lib should be named as &#8220;libadsp_hvx_sample_algo.so&#8221;, the main processing function in QDSP6 lib should be named as &#8220;hvx_sample_algo&#8221; and the get_config function in QDSP6 lib should be named as &#8220;hvx_sample_algo_get_config&#8221;.
</p><h2>
<a name="Building%20examples"></a>Building examples
</h2><p>
Steps to build the hvx_add_constant example are as follows. The same applys to other camera streaming examples as well.
</p><h3>
<a name="Build%20OEM%20plugin:"></a>Build OEM plugin:
</h3><p>
From <code>&lt;sdk_root&gt;\examples\camera_streaming\hvx_add_constant_stub</code>:
</p><pre>make
</pre><p>
libmmcamera_hvx_add_constant.so will be generated under ship folder.
</p><h3>
<a name="Build%20QDSP6%20lib:"></a>Build QDSP6 lib:
</h3><p>
From <code>&lt;sdk_root&gt;\examples\camera_streaming\hvx_add_constant</code>:
</p><pre>make tree V=hexagon_Release_dynamic_toolv80_v60 VERBOSE=1
</pre><p>
Note that the &#8220;tree&#8221; in the make command is necessary to build all the example's dependencies for the specified variant (hexagon_ReleaseG). VERBOSE=1 is an optional flag to display the details of the make and its included simulation test result. Subsequent rebuilds of the example for the same variant can omit the &#8220;tree&#8221; as follows.
</p><pre>make V=hexagon_Release_dynamic_toolv80_v60
</pre><p>
Note that this make command builds the QDSP6 lib in shared library (.so) format. This shared library will be loaded to target chip-set that supports HVX streaming.
</p><h2>
<a name="Load%20example%20to%20device"></a>Load example to device
</h2><p>
There is a way to test camera streaming code off-line on simulator (given below), but due to the nature of streaming, examples are usually tested on a target device with proper imaging sensor mounted.
</p><p>
As a pre-requirement, the target device should have APPS build and DSP build be pre-loaded. See [Dependencies]page for details. On top of that, taking hvx_add_constant as example:
</p><p>
NOTE: If you have the images distributed by Qualcomm, you should already have these files on the device. There is no need to push the files on to the device for first time verification
</p><ul type="circle">
<li>
<p>
push <code>&lt;sdk_root&gt;\examples\camera_streaming\hvx_add_constant\hexagon_Release_dynamic_toolv80_v60\libadsp_hvx_add_constant.so</code> to <code>/system/lib/rfsa/adsp</code> on device
</p>
</li><li>
<p>
push <code>&lt;sdk_root&gt;\examples\camera_streaming\hvx_add_constant_stub\hexagon_Release_dynamic_toolv80_v60\libmmcamera_hvx_add_constant.so</code> to <code>/system/lib</code> on device
</p>
</li><li>
<p>
make sure that the test sig is present under /system/lib/rfsa/adsp. For the details of generating test sig for your device, click <a href="../Tools_Signing.html">here</a>
</p>
</li>
</ul><h2>
<a name="Running%20the%20examples"></a>Running the examples
</h2><p>
Currently the way to run camera streaming examples is to use adb shell setprop command to enable and disable it.
</p><ul type="circle">
<li>
<p>
Assuming OEM plugin name is &#8220;libmmcamera_hvx_add_constant.so&#8221;, do the following and this enables HVX camera streaming and loads the specified QDSP6 lib for processing.
</p><pre>adb shell setprop persist.camera.hvx_lib_1 "libmmcamera_hvx_add_constant.so"
</pre><p>
Then open any camera application on device to see the pixel data processing effects. For hvx_add_constant example, bright area will periodically boosted to pink color.
</p>
</li><li>
<p>
To disable streaming, which make pixel data completely bypass HVX streaming module and act as a normal ISP, do
</p><pre>adb shell setprop persist.camera.hvx_lib_1 ""
</pre>
</li>
</ul><h2>
<a name="Collect%20Frame%20Dump"></a>Collect Frame Dump
</h2><ul type="circle">
<li>
<p>
To Enable frame dump, set property &#8220;persist.camera.hvx_fdump_en&#8221;. The value
</p>
</li>
</ul><p>
of this property is the number of frames to dump. Do the following to enable dump for first 10 frames.
</p><pre>adb shell setprop persist.camera.hvx_fdump_en "10"
</pre><h2>
<a name="Debug%20and%20logging"></a>Debug and logging
</h2><p>
HVX camera streaming works on both Android side and DSP side.
</p><p>
To collect Android log:
</p><pre>adb logcat -vthreadtime &gt; log.txt 
</pre><p>
In the log file, search for &#8220;iface_hvx_&#8221; for information.
</p><p>
To collect DSP side log:
</p><p>
Open QXDM application, select &#8220;Messages View&#8221; in View drop down menu, then the logs would come. Right click and select &#8220;Export All Text...&#8221; to save current logs into file. Search for &#8220;hvx_app_&#8221; for information.
</p><p>
HVX camera streaming uses fastrpc heavily, please refer to <a href="../FAQ_FastRPC.html">fastrpc page</a> to understand fastrpc related issues.
</p><h2>
<a name="SDM845%20Camera%20Streaming"></a>SDM845 Camera Streaming
</h2><h2>
<a name="Steps%20to%20verify%20Camera%20Streaming:"></a>Steps to verify Camera Streaming:
</h2><p>
The steps to verify camera streaming are different for SDM845 than SDM820, SDM835 and SDM660; as the camera software architecture on CPU/HLOS side has changed to CamX.
</p><p>
Please follow the below steps to verify.
</p><ol type="1">
<li>
<p>
Flash the appropriate SDM845 build e.g. SDM845.LA.1.0.r1-00476-STD.PROD-1 to
</p>
</li>
</ol><p>
device.
</p><ol type="1">
<li>
<p>
Check if the libdsp_streamer_add_constant.so (example skel) &amp;
</p>
</li>
</ol><p>
libdsp_streamer_skel.so (streamer framework skel) are present in /vendor/lib/rfsa/adsp on the device.
</p><ol type="1">
<li>
<p>
If not present on device, it should be at below locations in HLOS build;
</p>
</li>
</ol><p>
push them to /vendor/lib/rfsa/adsp on SDM845 device.
</p><p>
&lt;HLOS BUILD&gt;/vendor/qcom/proprietary/camx/src/hwl/dspinterfaces/libdsp_streamer_skel.so
</p><p>
&lt;HLOS BUILD&gt;/vendor/qcom/proprietary/chi-cdk/vendor/node/hvx/addconstant/libdsp_streamer_add_constant.so
</p><p>
If you cannot find it in the above mentioned locations, create a case and we shall look into it.
</p><ol type="1">
<li>
<p>
Enable camera streaming (HVX) mode.
</p>
</li>
</ol><p>
adb root adb remount
</p><p>
Create a new text file with name <b>camxoverridesettings.txt</b> and insert <b>enableHVXStreaming=1</b> in file and then push it to the device at following location /vendor/etc/camera. Create the folders if they are not already present.
</p><p>
or
</p><p>
If the file exists then do: adb shell echo enableHVXStreaming=1 &gt; /vendor/etc/camera/camxoverridesettings .txt
</p><p>
adb reboot adb root adb remount adb shell setenforce 0
</p><ol type="1">
<li>
<p>
Launch Snapdragon Camera App on MTP or the respective camera app on the
</p>
</li>
</ol><p>
device in Preview mode and you should see bright area will be periodically boosted to pink color, which indicates the camera streaming mode is working with add constant example.
</p><h2>
<a name="Files%20in%20SDK"></a>Files in SDK
</h2><h3>
<a name="Camera%20Streaming%20Framework"></a>Camera Streaming Framework
</h3><p>
It is not provided in source. The generated library is located at:
</p><p>
&lt;SDK Root&gt;\libs\camera_streaming\framework\ship<br>hexagon_Release_dynamic_toolv81_v65\libdsp_streamer_skel.so
</p><p>
NOTE: This file may not be the latest and is placed here for successful linking of the example code developed on DSP side. DO NOT push this shared object to device as the build flashed to device will already be using an updated version.
</p><h3>
<a name="Example:"></a>Example:
</h3><p>
Example source code is located at: &lt;SDK Root&gt;\examples\camera_streaming\hvx_add_constant
</p><p>
To build example:
</p><p>
make tree_clean V=hexagon_Release_dynamic_toolv81_v65 VERBOSE=1 make tree V=hexagon_Release_dynamic_toolv81_v65 VERBOSE=1
</p><p>
After successful compilation, the shared object libdsp_streamer_add_constant.so will be generated and placed in:
</p><p>
&lt;SDK root&gt;\examples\camera_streaming\hvx_add_constant\hexagon_Release_dynamic_toolv81_v65\ship
</p><p>
NOTE: This example will eventually be replaced with camera streaming algorithm or skel code that will run on the DSP in camera streaming mode.
</p><h2>
<a name="OEM%20Plug-in:"></a>OEM Plug-in:
</h2><p>
This is the OEM Plug-in to be implemented on the HLOS or CPU side. It requires familarity in working with CamX software architecture to be able to successfully integrate and load the plug-in.
</p><p>
for example, the &#8220;add constant&#8221; OEM plug-in source code and build makefiles are placed at: &lt;HLOS Build&gt;\android\vendor\qcom\proprietary\chi-cdk\vendor\node\hvx\addconstant
</p><p>
In, &lt;HLOS build&gt;\android\vendor\qcom\proprietary\chi-cdk\vendor\node\hvx\addconstant, camxchihvxaddconstant.cpp, implements the OEM plug-in APIs as required and listed in chiisphvxdefs.h.
</p><p>
The Android.mk in the folder &lt;HLOS Build&gt;\android\vendor\qcom\proprietary\chi-cdk\vendor\node\hvx\addconstant\build\android makes the OEM plug-in, part of the com.qti.hvx.addconstant module.
</p><p>
Similar changes are required when implementing a custom OEM-plugin, so that the custom algorithm name, static and dynamic config. can be specified to DSP.
</p><p align="center" style="display:block;padding-top: 50px;">
  Copyright &#169; 2018 Qualcomm Technologies Inc. All rights reserved.

</p><a style="display:block;padding-bottom: 700px;"></a></div></div>
</body>
</html>
