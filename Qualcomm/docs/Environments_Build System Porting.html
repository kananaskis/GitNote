<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta content="text/html;charset=utf-8" http-equiv="Content-Type">
<style type="text/css">
table {
   border-collapse: collapse;
   border-width: 1px;
   border-spacing: 1px;
   border-color: transparent;
   margin: 16px 0;
   width: 100%;
}
th {
   background-color: #bbb; color: white;
}
td, th {
   border-style: solid;
   border-color: black;
   border-width: 1px;
   padding: 0 6px;
}
td p:first-child, th p:first-child {
   margin-top: 3px;
}
td p:last-child, th p:last-child {
   margin-bottom: 3px;
}

.smarkdoc {
  margin-left: 42px; margin-right: 42px;
  font-size: 13px;
  font-family: 'Lucida Grande', Geneva, Helvetica, Arial, sans-serif;
}

h1, h2, h3 { color: #3c4c6c; }
h1 {
  text-align: center;
  font-size: 200%;
/*    margin-left: -30px; */
  clear: both;
}
h2 {
  font-size: 160%;
  margin: 32px -40px 24px -42px;
  padding: 3px 24px 8px;
  border-bottom: 2px solid #5088c5;
  clear: both;
}
h3 {
  font-size: 130%;
  margin: 20px -4px 10px;
  padding: 4px;
  clear: both;
}
h4 {
  font-size: 110%;
  margin: 2em 0 1em;
}

pre {
  font-size: 90%;
  background-color: #f0f0f4; padding: 6px; border: 1px solid #d0d0ee;
  font-family: "Courier New", "Lucida Console", "Monaco", monospace;
}

.pre {
  font-size: 90%;
  padding: 6px;
  background-color: #f0f0f4;
  font-family: "Courier New", "Lucida Console", "Monaco", monospace;
}

code {
  font-size: 90%;
  font-family: "Courier New", "Lucida Console", "Monaco", monospace;
}

h3 code {
  font-size: 100%;
}

p {
  margin: 0.8em 0;
}
ul, ol {
  margin: 1em 0 1em 3em; padding: 0;
}
div.indent {
  margin: 0 3em;
}

a[href] {
  text-decoration: none;
  color: #2020b0;
}
a[href]:hover {
  border-bottom: 1px dotted #2030d0;
}

/* Smark Users Guide */

.codebox {
  padding: 0 1px;  margin-right:1px;
  border:1px solid #d0d0ee;
  background-color: #f0f0f4;
  font-weight: bold;
  font-family: "Courier New", "Lucida Console", "Monaco", monospace;
}

/* ================ Smark-specific classes ================ */

.indent {
  margin: 0 3em;
}

/*
|| Floats affect text flow but not block boundaries, so graphics in a DIV
|| would overlap floats if not for "clear: both"
*/
.diagram {
  margin: 18px 0;
  clear: both;
}

/* ASCII Art */

.art {
  margin-right: auto; margin-left: auto; /* center */
  font-family: Arial, Verdana, "Lucida Console", Monaco, monospace;
  font-weight: bold;
}
.art * {
   border-color: #543;
}
.art .dline, .art .drect {
   border-style: dotted;
}
.art .rect {
   -webkit-box-shadow: 0.2em 0.2em 0.3em rgba(0,0,0,0.3);
   -moz-box-shadow: 0.2em 0.2em 0.3em rgba(0,0,0,0.3);
   box-shadow: 0.2em 0.2em 0.2em #875;
   background-color: #f9faf4; /* #fafff4; #f8f8ec;  */
}
.art .nofx {
   background-color: #f9faf4;
}
.art .round {
   border-radius: 0.6em;
   -webkit-border-radius: 0.6em;
   -moz-border-radius: 0.6em;
}

/* .art .line {  -webkit-box-shadow: 0.1em 0.1em 0.2em rgba(0,0,0,0.3); } */

/* Sequence Charts */

.msc {
   font: 11px Verdana, Monaco, "Lucida Console";
   margin-left: auto; margin-right: auto;
   background-color: white;
   /* border: 1px solid #555; */  /* Useful for non-white pages */
}

/* Table of Contents */

.tocLevel {
  margin-left: 2em;
  font-weight: normal;
}
.tocLevel .tocLevel {
  font-size: 90%; /* ...of inherited font size */
  line-height: 150%; /* ...of font size */
}
.toc > .tocLevel {
  font-weight: bold;
  margin: 0.5em 0
}
.toc {
  column-count: 2; column-gap: 2em;
  -moz-column-count: 2; -moz-column-gap: 2em;
  -webkit-column-count: 2; -webkit-column-gap: 2em;
}

/* ordinary text content is in P elements */

td p:first-child, th p:first-child {
   margin-top: 3px;
}
td p:last-child, th p:last-child {
   margin-bottom: 3px;
}
li p:only-child {
  margin-top: 0;
  margin-bottom: 0;
}

/* ================ Print ================ */

@media print {

  @page {
    margin: 0.75in 0.75in;
    size: Letter;
    @bottom {
      content: counter(page);
      vertical-align: top;
      padding-top: 1em;
    }
  }
  h1 { text-align: center;
       margin: 3in 0 20px; }
  h2 { page-break-before: always; }
  h2 { string-set: section content() }
  .toc { margin: 3em -2em }
  .toc a::after {
     font-size: 10px;
     content: leader(' . ') "  " target-counter(attr(href), page);
  }
  table { page-break-inside: avoid; }
}

/* ================  Layout  ================ */
/*
 *  +------------------------+
 *  |         #header        |
 *  +----------+-------------+
 *  | #sidebar |  #content   |
 *  |          |             |
 *  +----------+-------------+
 *
 * CSS padding, border width, and border style (!) affect the actual height
 * (and in turn layout).
 */

#header {
  position: fixed;
  top: 0px;
  height: 32px;
  left: 0px;
  width: 100%;
  padding: 10px 10px 0 0;
}
#sidebar {
  position: fixed;
  top: 42px;
  bottom: 0px;
  left: 0px;
  min-width: 180px;
  overflow: auto;
  border: 1px solid transparent;
  border-width: 0 1px 0 1px;
  padding: 0px 5px 0px 5px;
}
#content {
  position: fixed;
  top: 60px;
  left: 200px;
  bottom: 0px;
  right: 0px;
  overflow: auto;
  -webkit-overflow-scrolling: touch;
  padding: 10px 20px;
  padding-top: 0;
}

/* ================  Styles  ================ */


body {
  font-family: "Lucida Grande", Helvetica, Arial, sans-serif;
  font-size: 16px;
}

#header {
  color: #fff;
  background: #555;
  text-align: center;
  font-size: 25px;
}

#sidebar {
  color: #000;
  background: #eee;
  border-right: 1px solid #bbb;
  text-align: left;
  font-size: 12px;
  line-height: 50%;
}

#sidebar h1 {
  margin: 0 0 0 0;
  border-left: 5px solid transparent;
  text-align: left;
  font-size: 12px;
  /*text-shadow: #fff 1px 0px;*/
  line-height: 1%;
}

#sidebar h2 {
  margin: 2px 0 8px 0;
  border-left: 5px solid transparent;
  text-align: center;
  font-size: 12px;
  /*text-shadow: #fff 1px 0px;*/
  line-height: 1%;
}



#content {
  margin: 0;
  font-size: 13px;
  line-height: 160%;
}

#content h1, #content h2 {
  border-bottom: 2px solid;
  font-size: 1.8em;
  font-weight: normal;
  margin: 2.0em 0px 1.3em 0px;
  padding-bottom: 0.6em;
  text-align: left;
}

#content h3 {
  color: #242220;
  font-size: 1.4em;
  font-weight: normal;
  margin: 2em 0px 0.8em 0px;
  text-shadow: #FFFFFF 0px 1px 1px;
}
#content h4 {
  font-size: 1.2em;
  font-weight: normal;
  margin: 2em 0px 0.5em 0px;
  text-shadow: #FFFFFF 0px 1px 1px;
}

a[href] {
  color: #05c;
  text-decoration: none;
}

#sidebar a {
  /*text-shadow:  1px 1px 2px #fff, -1px -1px #ddd;*/
  line-height: 40%;
}

pre, code {
  font-family: "Courier New", "Lucida Console", "Monaco", monospace;
  font-family: "Monaco", monospace;  font-size: 90%;
  background-color: #f8f8fa;
  border: 1px solid #e4e4ee;
  -webkit-border-radius: 2px;
  -moz-border-radius: 2px;
  border-radius: 2px;
  padding: 1px 0 0 1px;
}

pre {
  padding: 2px 4px;
}

table {
   border-collapse: collapse;
   border-width: 1px;
   border-spacing: 1px;
   border-color: transparent;
   margin: 16px 0;
   width: 100%;
}
th {
   background-color: #bbb; color: white;
}
td, th {
   border-style: solid;
   border-color: black;
   border-width: 1px;
   padding: 0 6px;
}

/* Highlight currently-selected sidebar link */

#sidebar a.thisfile {
  color: #557;
}

/* indentation */

#content {
   padding-left: 60px;
}
#content h1, 
#content h2, 
#content h3, h4 {
    margin-left: -30px;
}

h3 > code {
    font-size: 80%;
}

/* ================ Smark-specific classes ================ */

.indent {
  margin: 0 3em;
}

/*
|| Floats affect text flow but not block boundaries, so graphics in a DIV 
|| would overlap floats if not for "clear: both"
*/
.diagram {
  margin: 18px 0;
  clear: both;
}

/* ASCII Art */

.art {
  margin-right: auto; margin-left: auto; /* center */
  font-family: Arial, Verdana, "Lucida Console", Monaco, monospace;
  font-weight: bold;
}
.art * {
   border-color: #543;
}
.art .dline, .art .drect {
   border-style: dotted;
}
.art .rect {
   -webkit-box-shadow: 0.2em 0.2em 0.3em rgba(0,0,0,0.3);
   -moz-box-shadow: 0.2em 0.2em 0.3em rgba(0,0,0,0.3);
   box-shadow: 0.2em 0.2em 0.2em #875;
   background-color: #f9faf4; /* #fafff4; #f8f8ec;  */
}
.art .nofx {
   background-color: #f9faf4;
}
.art .round {
   border-radius: 0.6em;
   -webkit-border-radius: 0.6em;
   -moz-border-radius: 0.6em;
}

/* Sequence Charts */

.msc {
   font: 11px Verdana, Monaco, "Lucida Console"; 
   margin-left: auto; margin-right: auto;
   background-color: white;
   border: 1px solid #555;
}

/* Table of Contents */

.tocLevel {
  margin-left: 2em;
  font-weight: normal;
}
.tocLevel .tocLevel {
  font-size: 90%; /* ...of inherited font size */
  line-height: 150%; /* ...of font size */
}
/*
.toc > .tocLevel {
  font-weight: bold;
  margin: 0.5em 0
}
*/

.toc {
  column-count: 1; column-gap: 2em;
  -moz-column-count: 1; -moz-column-gap: 2em;
  -webkit-column-count: 1; -webkit-column-gap: 2em; 
   alternate: column-width: 235px; column-rule-width: 5px;
}


.columns {
  column-count: 2; column-gap: 2em;
  -moz-column-count: 2; -moz-column-gap: 2em;
  -webkit-column-count: 2; -webkit-column-gap: 2em; p
}

/* ordinary text content is in P elements */

td p:first-child, th p:first-child {
   margin-top: 3px;
}
td p:last-child, th p:last-child {
   margin-bottom: 3px;
}
li p:only-child {
  margin-top: 0;
  margin-bottom: 0;
}


/* ================ Print ================ */

@media print {

  #header, #content { position: static; }
  #sidebar { display: none; }

  @page {
    margin: 0.75in 0.75in;
    size: Letter;
    @bottom {
      content: counter(page);
      vertical-align: top;
      padding-top: 1em;
    }
  }
  h1 { text-align: center;
       margin: 1in 0 1in; }
  h2 { page-break-before: always; }
  h2 { string-set: section content() }
  .toc { margin: 3em 0 }
  .toc a::after {
     font-size: 10px;
     content: leader(' . ') "  " target-counter(attr(href), page);
  }
  table { page-break-inside: avoid; }
}


</style><style type="text/css">
.search { right: 20pt; position: fixed; top: 5pt }

</style><title>Build Environment Porting Guide</title>
</head><body>
<div class="smarkdoc"><div id="header">Hexagon SDK 3.4.3</div><div id="sidebar"><top><img src="images/sidebar_top.jpg"></top><script src="scripts/post.js" type="text/javascript"></script><form class="search" id="searchForm"><input id="searchquery" name="q" onkeydown="postFunctionKeydown(event, false)"><input id="searchButton" onclick="postFunction(false)" type="button" value="Search"></form><p>
<a href="index.html">Quick start</a>
</p><hr>
<p>
<a href="feature_matrix.html">Feature Matrix</a>
</p><hr>
<p>
<a href="hexagon_architecture.html">Hexagon Architecture</a>
</p><hr>
<p>
<a href="images/Hexagon_Document_Bundle.pdf#page=2881">Hexagon Compiler/Linker</a>
</p><hr>
<p>
<a href="hexagon_libraries.html">Hexagon Standard Libraries</a>
</p><hr>
<p>
<a href="images/80-VB419-178_QuRT_User_Guide.pdf">Hexagon RTOS</a>
</p><hr>
<p>
<a href="images/80-VB419-108_Hexagon_DSP_User_Guide.pdf">Hexagon DSP Programming</a>
</p><hr>
<h3>
<a name="Platforms"></a>Platforms
</h3><p>
<a href="Platforms_HLOS.html">HLOS</a>
</p><p>
<a href="Platforms_Simulator.html">Simulator</a>
</p><p>
<a href="Platforms_Target.html">Target</a>
</p><hr>
<h3>
<a name="Environments"></a>Environments
</h3><p>
<a href="Environments_Build%20System.html">Build System</a>
</p><p>
<a href="Environments_Build%20System%20Porting.html">Build System Porting</a>
</p><p>
<a href="Environments_Hexagon%20IDE.html">Hexagon IDE</a>
</p><hr>
<h3>
<a name="ArchitectureOverview"></a>ArchitectureOverview
</h3><p>
<a href="HVX/ArchitectureOverview.html">HVX</a>
</p><hr>
<h3>
<a name="Applications"></a>Applications
</h3><p>
<a href="Audio/Applications.html">Audio</a>
</p><p>
<a href="Camera%20streaming/Applications.html">Camera streaming</a>
</p><p>
<a href="Applications_Compute%20offload.html">Compute offload</a>
</p><p>
<a href="FastCV/Applications_Computer%20Vision.html">Computer Vision</a>
</p><p>
<a href="Neural%20Networks/Applications.html">Neural Networks</a>
</p><p>
<a href="Voice/Applications.html">Voice</a>
</p><hr>
<h3>
<a name="APIs"></a>APIs
</h3><p>
<a href="APIs_Async%20Message%20Queue.html">Async Message Queue</a>
</p><p>
<a href="APIs_DSP%20Clk%20&amp;%20Rsrc%20Mgmt.html">DSP Clk &amp; Rsrc Mgmt</a>
</p><p>
<a href="APIs_Dynamic%20Loading.html">Dynamic Loading</a>
</p><p>
<a href="APIs_FastRPC.html">FastRPC</a>
</p><hr>
<h3>
<a name="Examples"></a>Examples
</h3><p>
<a href="Audio/Examples.html">Audio</a>
</p><p>
<a href="Camera%20streaming/Examples.html">Camera streaming</a>
</p><p>
<a href="Examples_Common.html">Common</a>
</p><p>
<a href="Examples_ComputeHVX.html">ComputeHVX</a>
</p><p>
<a href="Examples_GeneralOverview.html">GeneralOverview</a>
</p><p>
<a href="Neural%20Networks/Examples.html">Neural Networks</a>
</p><hr>
<h3>
<a name="Testing"></a>Testing
</h3><p>
<a href="CAPIv2/Testing_CAPIv2%20Unit%20Tests.html">CAPIv2 Unit Tests</a>
</p><p>
<a href="Testing_Eclipse%20Unit%20Tests.html">Eclipse Unit Tests</a>
</p><hr>
<h3>
<a name="Debugging"></a>Debugging
</h3><p>
<a href="Debugging_Connect%20to%20Device.html">Connect to Device</a>
</p><p>
<a href="Debugging_Exceptions.html">Exceptions</a>
</p><p>
<a href="Debugging_Message%20Logging.html">Message Logging</a>
</p><p>
<a href="Debugging_Simulator.html">Simulator</a>
</p><p>
<a href="Debugging_Target.html">Target</a>
</p><hr>
<h3>
<a name="Tools"></a>Tools
</h3><p>
<a href="Tools_Hexagon%20Tools%208.3.html">Hexagon Tools 8.3</a>
</p><p>
<a href="Tools_IDL%20Compiler.html">IDL Compiler</a>
</p><p>
<a href="Tools_On%20Target%20Profiling.html">On Target Profiling</a>
</p><p>
<a href="Tools_Scripts.html">Scripts</a>
</p><p>
<a href="Tools_Signing.html">Signing</a>
</p><p>
<a href="Tools_UserGuides.html">UserGuides</a>
</p><p>
<a href="Tools_Utilities.html">Utilities</a>
</p><hr>
<h3>
<a name="FAQ"></a>FAQ
</h3><p>
<a href="FAQ_Common.html">Common</a>
</p><p>
<a href="FAQ_Dynamic%20Loading.html">Dynamic Loading</a>
</p><p>
<a href="FAQ_FastRPC.html">FastRPC</a>
</p><p>
<a href="FAQ_Hexagon%20IDE.html">Hexagon IDE</a>
</p><hr>
<h3>
<a name="Dependencies"></a>Dependencies
</h3><p>
<a href="Dependencies_Common.html">Common</a>
</p><hr>
<h3>
<a name="Release%20Notes"></a>Release Notes
</h3><p>
<a href="Release%20Notes_Common.html">Common</a>
</p><hr>
<h3>
<a name="Support"></a>Support
</h3><p>
<a href="Support_Contact.html">Contact</a>
</p><center><img src="images/sidebar_bot.jpg"></center></div><div id="content"><a name="_top_" style="display:block;"></a><h1>
<a name="Build%20Environment%20Porting%20Guide"></a>Build Environment Porting Guide
</h1><div class="toc"><div class="tocLevel"><a href="#Overview">Overview</a></div><div class="tocLevel"><a href="#Technical%20Background">Technical Background</a><div class="tocLevel"><a href="#Build%20Variants">Build Variants</a></div><div class="tocLevel"><a href="#Conventions">Conventions</a></div></div><div class="tocLevel"><a href="#QAIC%20IDL%20Compiler">QAIC IDL Compiler</a><div class="tocLevel"><a href="#Location%20of%20Executable">Location of Executable</a></div><div class="tocLevel"><a href="#Common%20Include%20Paths">Common Include Paths</a></div><div class="tocLevel"><a href="#Example%20command%20line">Example command line</a></div><div class="tocLevel"><a href="#Expected%20output%20for%20foo.idl">Expected output for foo.idl</a></div></div><div class="tocLevel"><a href="#Building%20the%20Application%20Processor%20(AP)%20side%20module">Building the Application Processor (AP) side module</a><div class="tocLevel"><a href="#Dependent%20modules">Dependent modules</a></div><div class="tocLevel"><a href="#Compiler/Linker%20Options">Compiler/Linker Options</a></div></div><div class="tocLevel"><a href="#Building%20the%20Hexagon%20DSP%20side%20module">Building the Hexagon DSP side module</a><div class="tocLevel"><a href="#_Dependent%20modules">Dependent modules</a></div><div class="tocLevel"><a href="#Compiler%20Options">Compiler Options</a></div><div class="tocLevel"><a href="#Linker%20Options">Linker Options</a></div></div><div class="tocLevel"><a href="#Building%20a%20Hexagon%20Simulator%20based%20executable">Building a Hexagon Simulator based executable</a><div class="tocLevel"><a href="#__Dependent%20modules">Dependent modules</a></div><div class="tocLevel"><a href="#_Compiler/Linker%20Options">Compiler/Linker Options</a></div></div><div class="tocLevel"><a href="#Forward-compatibility">Forward-compatibility</a></div></div><h2>
<a name="Overview"></a>Overview
</h2><p>
The target audience of this document are build system engineers who wish to build hexagon offload modules in their own build system. This document covers the details of <i>how to generate command line options for compiler and linker</i> with Hexagon SDK and use such information when packaging or porting to a different build system.
</p><p>
The exact details of command line options and directory layout are subject to change in future releases. It's always good practice to log the command out in verbose way to confirm when verifying on a different build system.
</p><p>
This guide will try to be written in a build-system-agnostic way, but still assumes reasonable knowledge of common make systems like gnu make.
</p><p>
To use and understand the build system provided with the Hexagon SDK developers are advised to refer to <a href="Environments_Build%20System.html?">Build System</a>.
</p><h2>
<a name="Technical%20Background"></a>Technical Background
</h2><p>
The Hexagon SDK is based on the working model of <a href="Applications_Compute%20offload.html">Computational Offload</a>. Please follow <a href="index.html">Quick start</a> to get the overview of whole picture how tasks are offloaded to the DSP.
</p><h3>
<a name="Build%20Variants"></a>Build Variants
</h3><p>
A very important goal of coding up a build system is to support different build configurations or variants (targets, release vs debug modules, architectures). Hexagon SDK's make.d build system supports this with an expandable way of defining a <b>variant</b> string, that feeds into <b>V</b> makefile variable. Most of the logic in the build system depends on the definition of the <b>V</b> variable passed in. This detail is specific to make.d, but would be good to have this background knowledge as some of the following discussion depend on the existing of variable <b>V</b>. Please refer to <a href="Environments_Build%20System.html#Variants">Build System</a> for more details.
</p><p>
One important thing to note about make.d is the location of both the intermediate and the output files (.o, .so, .a, ...) as well as the location of the dependent libraries are named in accordance with the variant that is being built.
</p><h3>
<a name="Conventions"></a>Conventions
</h3><p>
In this document, we are going use the ${VARAIBLE} nomenclature for environment variables such as <b>HEXAGON_SDK_ROOT</b> and build-variant variables such as <b>V</b>. For windows users, you can always interpret it as %VARIABLE%.
</p><h2>
<a name="QAIC%20IDL%20Compiler"></a>QAIC IDL Compiler
</h2><h3>
<a name="Location%20of%20Executable"></a>Location of Executable
</h3><p>
<a href="Tools_IDL%20Compiler.html">IDL Compiler</a> is the key part of the compute offload model. IDL Compiler is located at <i>${HEXAGON_SDK_ROOT}/tools/qaic/</i>
</p><h3>
<a name="Common%20Include%20Paths"></a>Common Include Paths
</h3><p>
${HEXAGON_SDK_ROOT}/incs
</p><p>
${HEXAGON_SDK_ROOT}/incs/stddef
</p><p>
${HEXAGON_SDK_ROOT}/libs/common/remote/ship/${V}
</p><p>
${HEXAGON_SDK_ROOT}/libs/common/rpcmem/${V}/ship
</p><p>
${HEXAGON_SDK_ROOT}/libs/common/adspmsgd/ship/${V}
</p><h3>
<a name="Example%20command%20line"></a>Example command line
</h3><p>
Please refer to <a href="qaic_users_guide.html#Command-line%20usage">User Guide</a> for more details
</p><ul class="indent">
<li>
<p>
-mdll Generate DLL mapping.
</p>
</li><li>
<p>
-o output directory
</p>
</li>
</ul><pre>
${HEXAGON_SDK_ROOT}/tools/qaic/Linux/qaic
-mdll 
-o android_Release
-I${HEXAGON_SDK_ROOT}/libs/fastcv/dspCV/android_Release/ship
-I${HEXAGON_SDK_ROOT}/libs/common/rpcmem/android_Release/ship
-I${HEXAGON_SDK_ROOT}/libs/common/adspmsgd/ship/android_Release
-I${HEXAGON_SDK_ROOT}/incs
-I${HEXAGON_SDK_ROOT}/libs/common/remote/ship/android_Release
-I${HEXAGON_SDK_ROOT}/incs/stddef
-Iandroid_Release inc/benchmark.idl
</pre><h3>
<a name="Expected%20output%20for%20foo.idl"></a>Expected output for foo.idl
</h3><p>
We shall be expecting the following 3 files that are generated in the <i>out</i> directory.
</p><ul type="circle">
<li>
<p>
foo.h
</p><p>
The header file containing the 'C' function declarations. This file should be included in both the <i>caller</i> and <i>callee</i>'s source code and used when calling the offloaded function as well as when defining the implementation of the offloaded function.
</p>
</li><li>
<p>
foo_sub.c
</p><p>
Stub source file that shall be built into the <i>caller</i> side of the code. AP side if calling from the AP to the Hexagon DSP.
</p>
</li><li>
<p>
foo_skel.c
</p><p>
Skeleton source file that shall be included into <i>callee</i> side of the code. Hexagon DSP side if calling from the AP to the Hexagon DSP.
</p>
</li>
</ul><h2>
<a name="Building%20the%20Application%20Processor%20(AP)%20side%20module"></a>Building the Application Processor (AP) side module
</h2><h3>
<a name="Dependent%20modules"></a>Dependent modules
</h3><table><tr><td><p>
Module
</p></td><td><p>
source/binary location
</p></td><td><p>
header location
</p></td><td><p>
Description
</p></td></tr><tr><td><p>
lib<i>a</i>dsprpc.so / lib<i>c</i>dsprpc.so
</p></td><td><p>
${HEXAGON_SDK_ROOT}/libs/common/remote/ship/${V}/
</p></td><td><p>
${HEXAGON_SDK_ROOT}/libs/common/remote/ship/${V}/
</p></td><td><p>
<a href="APIs_FastRPC.html#Software%20components">FastRPC app side lib</a>
</p></td></tr><tr><td><p>
rpcmem.a
</p></td><td><p>
${HEXAGON_SDK_ROOT}/libs/common/rpcmem
</p></td><td><p>
${HEXAGON_SDK_ROOT}/libs/common/rpcmem
</p></td><td><p>
<a href="APIs_FastRPC.html#RPCMem">sample code on using Android's ION memory allocator</a>
</p></td></tr><tr><td><p>
Common Headers
</p></td><td></td><td><p>
${HEXAGON_SDK_ROOT}/incs
</p></td><td><p>
Common headers suck as HAP_*.h and AEE*.h files
</p></td></tr><tr><td><p>
IDL Header &amp; _stub.c
</p></td><td></td><td><p>
&lt;IDL-output-dir&gt;/foo.h &amp; foo_stub.c
</p></td><td><p>
fastRPC caller side
</p></td></tr></table><h3>
<a name="Compiler/Linker%20Options"></a>Compiler/Linker Options
</h3><p>
libadsprpc.so and libcdsprpc.so are delivered as prebuilt libraries. So by including the right header file and linking with them at link time, you should be able to call into the library.
</p><p>
For C code for rpcmem.a, you shall be able to just use compiler options that work for other files within your build system. No special compiler/linker options are needed.
</p><h2>
<a name="Building%20the%20Hexagon%20DSP%20side%20module"></a>Building the Hexagon DSP side module
</h2><h3>
<a name="_Dependent%20modules"></a>Dependent modules
</h3><table><tr><td><p>
Module
</p></td><td><p>
source/binary location
</p></td><td><p>
header location
</p></td><td><p>
Description
</p></td></tr><tr><td><p>
Common Headers
</p></td><td></td><td><p>
${HEXAGON_SDK_ROOT}/incs
</p></td><td><p>
Common headers as AEE*.h files
</p></td></tr><tr><td><p>
IDL Header &amp; _skel.c
</p></td><td></td><td><p>
&lt;IDL-output-dir&gt;/foo.h &amp; foo_skel.c
</p></td><td><p>
fastRPC callee side
</p></td></tr></table><h3>
<a name="Compiler%20Options"></a>Compiler Options
</h3><p>
The Hexagon Tools (compiler, linker, etc..) are based on LLVM and so most of the options adhere to either standard LLVM options or legacy GNU options.
</p><p>
The following is the example of compiler options for a C file. All others are standard &#8220;compiler&#8221; options, except -mv65 and -mhvx-double. These are <i>Processor version</i> flags that you can find the detail in section 4.3.14 Processor Version from <i>Hexagon C/C++ Compiler User Guide(80-VB419-89 P)</i>
</p><ul>
<li>
<p>
-mv65 specify the Hexagon processor version
</p>
</li><li>
<p>
-mhvx-double specifies the HVX extensions in double mode
</p>
</li>
</ul><pre>../../../qctp406/pkg/hexagon/../8.2.04-Linux/Tools/bin/hexagon-clang  
-mv65
-c -v -G0 -g -O2  -Wall -Werror -Wno-cast-align -Wpointer-arith
-Wno-missing-braces -Wno-strict-aliasing  -fno-exceptions
-fno-strict-aliasing -fno-zero-initialized-in-bss -fdata-sections 
-Wstrict-prototypes -Wnested-externs 
-mhvx-double
-D__FILENAME__=\"benchmark_skel.c\"
-I../../../qctp406/pkg/qurt_install//computev65/include
-I../../../qctp406/pkg/qurt_install//computev65/include/qurt
-I../../../qctp406/pkg/qurt_install//computev65/include/posix
-I../dspCV/hexagon_ReleaseG_toolv82_v65/ship
-I../../../qctp406/pkg/rpcmem/hexagon_ReleaseG_toolv82_v65/ship
-I../../../qctp406/pkg/test_util/hexagon_ReleaseG_toolv82_v65/ship
-I../../../qctp406/pkg/HAP
-I../../../qctp406/pkg/hexagon_ReleaseG_toolv82_v65
-I../../../qctp406/pkg/stddef -Ihexagon_ReleaseG_toolv82_v65  -o
hexagon_ReleaseG_toolv82_v65/benchmark_skel.o
hexagon_ReleaseG_toolv82_v65/benchmark_skel.c
</pre><h3>
<a name="Linker%20Options"></a>Linker Options
</h3><p>
This is an example linker command line. Key options are architecture (arch) ones, and all others are common linker options. For details of the definition, please refer to Linker chapter in <i>Hexagon Utilities User Guide (80-N2040-15N)</i>
</p><ul>
<li>
<p>
-march=hexagon -mcpu=hexagonv65: Specify the Hexagon process version
</p>
</li>
</ul><pre>
 "/local/mnt/workspace/xqi/Qualcomm/Hexagon_SDK/3.4.0/tools/HEXAGON_Tools/8.2.04/Tools/bin/hexagon-link"
-march=hexagon -mcpu=hexagonv65 
-shared -call_shared -G0 
-o hexagon_ReleaseG_dynamic_toolv82_v65/libbenchmark_skel.so
${HEXAGON_SDK_ROOT}/tools/HEXAGON_Tools/8.2.04/Tools/bin/../target/hexagon/lib/v65/G0/pic/initS.o
-L${HEXAGON_SDK_ROOT}/tools/HEXAGON_Tools/8.2.04/Tools/bin/../target/hexagon/lib/v65/G0/pic
-L${HEXAGON_SDK_ROOT}/tools/HEXAGON_Tools/8.2.04/Tools/bin/../target/hexagon/lib/v65/G0
-L${HEXAGON_SDK_ROOT}/tools/HEXAGON_Tools/8.2.04/Tools/bin/../target/hexagon/lib/v65
-L${HEXAGON_SDK_ROOT}/tools/HEXAGON_Tools/8.2.04/Tools/bin/../target/hexagon/lib
-Bsymbolic
${HEXAGON_SDK_ROOT}/tools/HEXAGON_Tools/8.2.04/Tools/target/hexagon/lib/v65/G0/pic/libgcc.a
--wrap=malloc --wrap=calloc --wrap=free --wrap=realloc --wrap=memalign
--wrap=__stack_chk_fail -lc
-Map=hexagon_ReleaseG_dynamic_toolv82_v65/libbenchmark_skel.so.map
-soname=libbenchmark_skel.so 
--start-group
hexagon_ReleaseG_dynamic_toolv82_v65/benchmark_skel.o
hexagon_ReleaseG_dynamic_toolv82_v65/benchmark_imp.o
hexagon_ReleaseG_dynamic_toolv82_v65/dilate5x5_imp.o
...
${HEXAGON_SDK_ROOT}/libs/fastcv/dspCV/hexagon_ReleaseG_dynamic_toolv82_v65/ship/libdspCV_skel.so
--end-group --start-group -lgcc --end-group
${HEXAGON_SDK_ROOT}/tools/HEXAGON_Tools/8.2.04/Tools/bin/../target/hexagon/lib/v65/G0/pic/finiS.o
</pre><h2>
<a name="Building%20a%20Hexagon%20Simulator%20based%20executable"></a>Building a Hexagon Simulator based executable
</h2><h3>
<a name="__Dependent%20modules"></a>Dependent modules
</h3><p>
We need special helper libraries from QuRT OS, most of them reside in ${HEXAGON_SDK_ROOT/libs/common/qurt directory. And a couple C and architectural helper libraries from the Hexagon tool chain.
</p><p>
For more details on building with QuRT please refer to <i>Hexagon QuRT RTOS System Build Guide (80-VB419-79)</i>
</p><h3>
<a name="_Compiler/Linker%20Options"></a>Compiler/Linker Options
</h3><p>
Building for the simulator is similar to building dynamic libraries. The Difference is we need special linker options to generate executable (stand-alone) binary that the simulator loads and executes.
</p><p>
As you can see from the following sample command line, we need a specific starting address and a group of helper libraries to generate the complete executable for the simulator.
</p><p>
Take particular note to the order of the .o and libs specified. For example, init.o must be first and fini.o must be last. Your custom libraries will go in the middle (taking the place of libdsdpCV_skel.a for example.)
</p><pre>
${HEXAGON_SDK_ROOT}/tools/HEXAGON_Tools/8.2.04/Tools/bin/hexagon-clang
-mv65 
-g -nodefaultlibs -nostdlib 
-Wl,--section-start -Wl,.start=0x23000000
-o ${OUT}/benchmark_q 
-Wl,--start-group
${OUT}/benchmark_skel.o
${OUT}/benchmark_imp.o
${OUT}/benchmark.o
${OUT}/dilate5x5_ref.o
...
{HEXAGON_SDK_ROOT}/tools/HEXAGON_Tools/8.2.04/Tools/target/hexagon/lib/v65/G0/init.o
{HEXAGON_SDK_ROOT}/libs/common/qurt//computev65/lib/crt1.o
{HEXAGON_SDK_ROOT}/libs/common/qurt//computev65/lib/libqurt.a
{HEXAGON_SDK_ROOT}/tools/HEXAGON_Tools/8.2.04/Tools/target/hexagon/lib/v65/G0/libc.a
{HEXAGON_SDK_ROOT}/tools/HEXAGON_Tools/8.2.04/Tools/target/hexagon/lib/v65/G0/libqcc.a
{HEXAGON_SDK_ROOT}/tools/HEXAGON_Tools/8.2.04/Tools/target/hexagon/lib/v65/G0/libhexagon.a
{HEXAGON_SDK_ROOT}/libs/common/qurt//computev65/lib/libqurtcfs.a
{HEXAGON_SDK_ROOT}/libs/common/qurt//computev65/lib/libtimer.a
{HEXAGON_SDK_ROOT}/libs/common/qurt//computev65/lib/libposix.a
{HEXAGON_SDK_ROOT}/test/common/test_util/hexagon_ReleaseG_toolv82_v65/ship/test_util.a
{HEXAGON_SDK_ROOT}/libs/common/atomic/hexagon_ReleaseG_toolv82_v65/ship/atomic.a
{HEXAGON_SDK_ROOT}/libs/fastcv/dspCV/hexagon_ReleaseG_toolv82_v65/ship/libdspCV_skel.a
{HEXAGON_SDK_ROOT}/tools/HEXAGON_Tools/8.2.04/Tools/target/hexagon/lib/v65/G0/fini.o
-Wl,--end-group 
</pre><h2>
<a name="Forward-compatibility"></a>Forward-compatibility
</h2><p>
Now that you have successfully ported the Hexagon commands onto your own build system, and it's working perfectly. How to make sure your own build system continues to work once you pick up a new version of the Hexagon SDK? Hexagon SDK should upgrade this build guide to the latest information in future releases so refer to the latest to determine if anything has changed. But it's always a good practice to keep some referencing point from current build system
</p><p>
One suggestion would be that you structure your build system supporting file similar to the following two files.
</p><ul>
<li>
<p>
${HEXAGON_SDK_ROOT}/build/make.d.ext/hexagon/defines_hexagon_8_1.min
</p><p>
defines the compiler and linker options for dynamic libraries
</p>
</li><li>
<p>
${HEXAGON_SDK_ROOT}/libs/common/qurt/qurt_libs.min
</p><p>
defines the linker options for simulator based executables
</p>
</li>
</ul><p>
When the next version of tools and micro-architecture comes out, the above two files will be updated with the latest working configuration.
</p><p align="center" style="display:block;padding-top: 50px;">
  Copyright &#169; 2018 Qualcomm Technologies Inc. All rights reserved.

</p><a style="display:block;padding-bottom: 700px;"></a></div></div>
</body>
</html>
