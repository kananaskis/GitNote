<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta content="text/html;charset=utf-8" http-equiv="Content-Type">
<style type="text/css">
table {
   border-collapse: collapse;
   border-width: 1px;
   border-spacing: 1px;
   border-color: transparent;
   margin: 16px 0;
   width: 100%;
}
th {
   background-color: #bbb; color: white;
}
td, th {
   border-style: solid;
   border-color: black;
   border-width: 1px;
   padding: 0 6px;
}
td p:first-child, th p:first-child {
   margin-top: 3px;
}
td p:last-child, th p:last-child {
   margin-bottom: 3px;
}

.smarkdoc {
  margin-left: 42px; margin-right: 42px;
  font-size: 13px;
  font-family: 'Lucida Grande', Geneva, Helvetica, Arial, sans-serif;
}

h1, h2, h3 { color: #3c4c6c; }
h1 {
  text-align: center;
  font-size: 200%;
/*    margin-left: -30px; */
  clear: both;
}
h2 {
  font-size: 160%;
  margin: 32px -40px 24px -42px;
  padding: 3px 24px 8px;
  border-bottom: 2px solid #5088c5;
  clear: both;
}
h3 {
  font-size: 130%;
  margin: 20px -4px 10px;
  padding: 4px;
  clear: both;
}
h4 {
  font-size: 110%;
  margin: 2em 0 1em;
}

pre {
  font-size: 90%;
  background-color: #f0f0f4; padding: 6px; border: 1px solid #d0d0ee;
  font-family: "Courier New", "Lucida Console", "Monaco", monospace;
}

.pre {
  font-size: 90%;
  padding: 6px;
  background-color: #f0f0f4;
  font-family: "Courier New", "Lucida Console", "Monaco", monospace;
}

code {
  font-size: 90%;
  font-family: "Courier New", "Lucida Console", "Monaco", monospace;
}

h3 code {
  font-size: 100%;
}

p {
  margin: 0.8em 0;
}
ul, ol {
  margin: 1em 0 1em 3em; padding: 0;
}
div.indent {
  margin: 0 3em;
}

a[href] {
  text-decoration: none;
  color: #2020b0;
}
a[href]:hover {
  border-bottom: 1px dotted #2030d0;
}

/* Smark Users Guide */

.codebox {
  padding: 0 1px;  margin-right:1px;
  border:1px solid #d0d0ee;
  background-color: #f0f0f4;
  font-weight: bold;
  font-family: "Courier New", "Lucida Console", "Monaco", monospace;
}

/* ================ Smark-specific classes ================ */

.indent {
  margin: 0 3em;
}

/*
|| Floats affect text flow but not block boundaries, so graphics in a DIV
|| would overlap floats if not for "clear: both"
*/
.diagram {
  margin: 18px 0;
  clear: both;
}

/* ASCII Art */

.art {
  margin-right: auto; margin-left: auto; /* center */
  font-family: Arial, Verdana, "Lucida Console", Monaco, monospace;
  font-weight: bold;
}
.art * {
   border-color: #543;
}
.art .dline, .art .drect {
   border-style: dotted;
}
.art .rect {
   -webkit-box-shadow: 0.2em 0.2em 0.3em rgba(0,0,0,0.3);
   -moz-box-shadow: 0.2em 0.2em 0.3em rgba(0,0,0,0.3);
   box-shadow: 0.2em 0.2em 0.2em #875;
   background-color: #f9faf4; /* #fafff4; #f8f8ec;  */
}
.art .nofx {
   background-color: #f9faf4;
}
.art .round {
   border-radius: 0.6em;
   -webkit-border-radius: 0.6em;
   -moz-border-radius: 0.6em;
}

/* .art .line {  -webkit-box-shadow: 0.1em 0.1em 0.2em rgba(0,0,0,0.3); } */

/* Sequence Charts */

.msc {
   font: 11px Verdana, Monaco, "Lucida Console";
   margin-left: auto; margin-right: auto;
   background-color: white;
   /* border: 1px solid #555; */  /* Useful for non-white pages */
}

/* Table of Contents */

.tocLevel {
  margin-left: 2em;
  font-weight: normal;
}
.tocLevel .tocLevel {
  font-size: 90%; /* ...of inherited font size */
  line-height: 150%; /* ...of font size */
}
.toc > .tocLevel {
  font-weight: bold;
  margin: 0.5em 0
}
.toc {
  column-count: 2; column-gap: 2em;
  -moz-column-count: 2; -moz-column-gap: 2em;
  -webkit-column-count: 2; -webkit-column-gap: 2em;
}

/* ordinary text content is in P elements */

td p:first-child, th p:first-child {
   margin-top: 3px;
}
td p:last-child, th p:last-child {
   margin-bottom: 3px;
}
li p:only-child {
  margin-top: 0;
  margin-bottom: 0;
}

/* ================ Print ================ */

@media print {

  @page {
    margin: 0.75in 0.75in;
    size: Letter;
    @bottom {
      content: counter(page);
      vertical-align: top;
      padding-top: 1em;
    }
  }
  h1 { text-align: center;
       margin: 3in 0 20px; }
  h2 { page-break-before: always; }
  h2 { string-set: section content() }
  .toc { margin: 3em -2em }
  .toc a::after {
     font-size: 10px;
     content: leader(' . ') "  " target-counter(attr(href), page);
  }
  table { page-break-inside: avoid; }
}

/* ================  Layout  ================ */
/*
 *  +------------------------+
 *  |         #header        |
 *  +----------+-------------+
 *  | #sidebar |  #content   |
 *  |          |             |
 *  +----------+-------------+
 *
 * CSS padding, border width, and border style (!) affect the actual height
 * (and in turn layout).
 */

#header {
  position: fixed;
  top: 0px;
  height: 32px;
  left: 0px;
  width: 100%;
  padding: 10px 10px 0 0;
}
#sidebar {
  position: fixed;
  top: 42px;
  bottom: 0px;
  left: 0px;
  min-width: 180px;
  overflow: auto;
  border: 1px solid transparent;
  border-width: 0 1px 0 1px;
  padding: 0px 5px 0px 5px;
}
#content {
  position: fixed;
  top: 60px;
  left: 200px;
  bottom: 0px;
  right: 0px;
  overflow: auto;
  -webkit-overflow-scrolling: touch;
  padding: 10px 20px;
  padding-top: 0;
}

/* ================  Styles  ================ */


body {
  font-family: "Lucida Grande", Helvetica, Arial, sans-serif;
  font-size: 16px;
}

#header {
  color: #fff;
  background: #555;
  text-align: center;
  font-size: 25px;
}

#sidebar {
  color: #000;
  background: #eee;
  border-right: 1px solid #bbb;
  text-align: left;
  font-size: 12px;
  line-height: 50%;
}

#sidebar h1 {
  margin: 0 0 0 0;
  border-left: 5px solid transparent;
  text-align: left;
  font-size: 12px;
  /*text-shadow: #fff 1px 0px;*/
  line-height: 1%;
}

#sidebar h2 {
  margin: 2px 0 8px 0;
  border-left: 5px solid transparent;
  text-align: center;
  font-size: 12px;
  /*text-shadow: #fff 1px 0px;*/
  line-height: 1%;
}



#content {
  margin: 0;
  font-size: 13px;
  line-height: 160%;
}

#content h1, #content h2 {
  border-bottom: 2px solid;
  font-size: 1.8em;
  font-weight: normal;
  margin: 2.0em 0px 1.3em 0px;
  padding-bottom: 0.6em;
  text-align: left;
}

#content h3 {
  color: #242220;
  font-size: 1.4em;
  font-weight: normal;
  margin: 2em 0px 0.8em 0px;
  text-shadow: #FFFFFF 0px 1px 1px;
}
#content h4 {
  font-size: 1.2em;
  font-weight: normal;
  margin: 2em 0px 0.5em 0px;
  text-shadow: #FFFFFF 0px 1px 1px;
}

a[href] {
  color: #05c;
  text-decoration: none;
}

#sidebar a {
  /*text-shadow:  1px 1px 2px #fff, -1px -1px #ddd;*/
  line-height: 40%;
}

pre, code {
  font-family: "Courier New", "Lucida Console", "Monaco", monospace;
  font-family: "Monaco", monospace;  font-size: 90%;
  background-color: #f8f8fa;
  border: 1px solid #e4e4ee;
  -webkit-border-radius: 2px;
  -moz-border-radius: 2px;
  border-radius: 2px;
  padding: 1px 0 0 1px;
}

pre {
  padding: 2px 4px;
}

table {
   border-collapse: collapse;
   border-width: 1px;
   border-spacing: 1px;
   border-color: transparent;
   margin: 16px 0;
   width: 100%;
}
th {
   background-color: #bbb; color: white;
}
td, th {
   border-style: solid;
   border-color: black;
   border-width: 1px;
   padding: 0 6px;
}

/* Highlight currently-selected sidebar link */

#sidebar a.thisfile {
  color: #557;
}

/* indentation */

#content {
   padding-left: 60px;
}
#content h1, 
#content h2, 
#content h3, h4 {
    margin-left: -30px;
}

h3 > code {
    font-size: 80%;
}

/* ================ Smark-specific classes ================ */

.indent {
  margin: 0 3em;
}

/*
|| Floats affect text flow but not block boundaries, so graphics in a DIV 
|| would overlap floats if not for "clear: both"
*/
.diagram {
  margin: 18px 0;
  clear: both;
}

/* ASCII Art */

.art {
  margin-right: auto; margin-left: auto; /* center */
  font-family: Arial, Verdana, "Lucida Console", Monaco, monospace;
  font-weight: bold;
}
.art * {
   border-color: #543;
}
.art .dline, .art .drect {
   border-style: dotted;
}
.art .rect {
   -webkit-box-shadow: 0.2em 0.2em 0.3em rgba(0,0,0,0.3);
   -moz-box-shadow: 0.2em 0.2em 0.3em rgba(0,0,0,0.3);
   box-shadow: 0.2em 0.2em 0.2em #875;
   background-color: #f9faf4; /* #fafff4; #f8f8ec;  */
}
.art .nofx {
   background-color: #f9faf4;
}
.art .round {
   border-radius: 0.6em;
   -webkit-border-radius: 0.6em;
   -moz-border-radius: 0.6em;
}

/* Sequence Charts */

.msc {
   font: 11px Verdana, Monaco, "Lucida Console"; 
   margin-left: auto; margin-right: auto;
   background-color: white;
   border: 1px solid #555;
}

/* Table of Contents */

.tocLevel {
  margin-left: 2em;
  font-weight: normal;
}
.tocLevel .tocLevel {
  font-size: 90%; /* ...of inherited font size */
  line-height: 150%; /* ...of font size */
}
/*
.toc > .tocLevel {
  font-weight: bold;
  margin: 0.5em 0
}
*/

.toc {
  column-count: 1; column-gap: 2em;
  -moz-column-count: 1; -moz-column-gap: 2em;
  -webkit-column-count: 1; -webkit-column-gap: 2em; 
   alternate: column-width: 235px; column-rule-width: 5px;
}


.columns {
  column-count: 2; column-gap: 2em;
  -moz-column-count: 2; -moz-column-gap: 2em;
  -webkit-column-count: 2; -webkit-column-gap: 2em; p
}

/* ordinary text content is in P elements */

td p:first-child, th p:first-child {
   margin-top: 3px;
}
td p:last-child, th p:last-child {
   margin-bottom: 3px;
}
li p:only-child {
  margin-top: 0;
  margin-bottom: 0;
}


/* ================ Print ================ */

@media print {

  #header, #content { position: static; }
  #sidebar { display: none; }

  @page {
    margin: 0.75in 0.75in;
    size: Letter;
    @bottom {
      content: counter(page);
      vertical-align: top;
      padding-top: 1em;
    }
  }
  h1 { text-align: center;
       margin: 1in 0 1in; }
  h2 { page-break-before: always; }
  h2 { string-set: section content() }
  .toc { margin: 3em 0 }
  .toc a::after {
     font-size: 10px;
     content: leader(' . ') "  " target-counter(attr(href), page);
  }
  table { page-break-inside: avoid; }
}


</style><style type="text/css">
.search { right: 20pt; position: fixed; top: 5pt }

</style><title>sysMon DSP Profiler</title>
</head><body>
<div class="smarkdoc"><div id="header">Hexagon SDK 3.4.3</div><div id="sidebar"><top><img src="images/sidebar_top.jpg"></top><script src="scripts/post.js" type="text/javascript"></script><form class="search" id="searchForm"><input id="searchquery" name="q" onkeydown="postFunctionKeydown(event, false)"><input id="searchButton" onclick="postFunction(false)" type="button" value="Search"></form><p>
<a href="index.html">Quick start</a>
</p><hr>
<p>
<a href="feature_matrix.html">Feature Matrix</a>
</p><hr>
<p>
<a href="hexagon_architecture.html">Hexagon Architecture</a>
</p><hr>
<p>
<a href="images/Hexagon_Document_Bundle.pdf#page=2881">Hexagon Compiler/Linker</a>
</p><hr>
<p>
<a href="hexagon_libraries.html">Hexagon Standard Libraries</a>
</p><hr>
<p>
<a href="images/80-VB419-178_QuRT_User_Guide.pdf">Hexagon RTOS</a>
</p><hr>
<p>
<a href="images/80-VB419-108_Hexagon_DSP_User_Guide.pdf">Hexagon DSP Programming</a>
</p><hr>
<h3>
<a name="Platforms"></a>Platforms
</h3><p>
<a href="Platforms_HLOS.html">HLOS</a>
</p><p>
<a href="Platforms_Simulator.html">Simulator</a>
</p><p>
<a href="Platforms_Target.html">Target</a>
</p><hr>
<h3>
<a name="Environments"></a>Environments
</h3><p>
<a href="Environments_Build%20System.html">Build System</a>
</p><p>
<a href="Environments_Build%20System%20Porting.html">Build System Porting</a>
</p><p>
<a href="Environments_Hexagon%20IDE.html">Hexagon IDE</a>
</p><hr>
<h3>
<a name="ArchitectureOverview"></a>ArchitectureOverview
</h3><p>
<a href="HVX/ArchitectureOverview.html">HVX</a>
</p><hr>
<h3>
<a name="Applications"></a>Applications
</h3><p>
<a href="Audio/Applications.html">Audio</a>
</p><p>
<a href="Camera%20streaming/Applications.html">Camera streaming</a>
</p><p>
<a href="Applications_Compute%20offload.html">Compute offload</a>
</p><p>
<a href="FastCV/Applications_Computer%20Vision.html">Computer Vision</a>
</p><p>
<a href="Neural%20Networks/Applications.html">Neural Networks</a>
</p><p>
<a href="Voice/Applications.html">Voice</a>
</p><hr>
<h3>
<a name="APIs"></a>APIs
</h3><p>
<a href="APIs_Async%20Message%20Queue.html">Async Message Queue</a>
</p><p>
<a href="APIs_DSP%20Clk%20&amp;%20Rsrc%20Mgmt.html">DSP Clk &amp; Rsrc Mgmt</a>
</p><p>
<a href="APIs_Dynamic%20Loading.html">Dynamic Loading</a>
</p><p>
<a href="APIs_FastRPC.html">FastRPC</a>
</p><hr>
<h3>
<a name="Examples"></a>Examples
</h3><p>
<a href="Audio/Examples.html">Audio</a>
</p><p>
<a href="Camera%20streaming/Examples.html">Camera streaming</a>
</p><p>
<a href="Examples_Common.html">Common</a>
</p><p>
<a href="Examples_ComputeHVX.html">ComputeHVX</a>
</p><p>
<a href="Examples_GeneralOverview.html">GeneralOverview</a>
</p><p>
<a href="Neural%20Networks/Examples.html">Neural Networks</a>
</p><hr>
<h3>
<a name="Testing"></a>Testing
</h3><p>
<a href="CAPIv2/Testing_CAPIv2%20Unit%20Tests.html">CAPIv2 Unit Tests</a>
</p><p>
<a href="Testing_Eclipse%20Unit%20Tests.html">Eclipse Unit Tests</a>
</p><hr>
<h3>
<a name="Debugging"></a>Debugging
</h3><p>
<a href="Debugging_Connect%20to%20Device.html">Connect to Device</a>
</p><p>
<a href="Debugging_Exceptions.html">Exceptions</a>
</p><p>
<a href="Debugging_Message%20Logging.html">Message Logging</a>
</p><p>
<a href="Debugging_Simulator.html">Simulator</a>
</p><p>
<a href="Debugging_Target.html">Target</a>
</p><hr>
<h3>
<a name="Tools"></a>Tools
</h3><p>
<a href="Tools_Hexagon%20Tools%208.3.html">Hexagon Tools 8.3</a>
</p><p>
<a href="Tools_IDL%20Compiler.html">IDL Compiler</a>
</p><p>
<a href="Tools_On%20Target%20Profiling.html">On Target Profiling</a>
</p><p>
<a href="Tools_Scripts.html">Scripts</a>
</p><p>
<a href="Tools_Signing.html">Signing</a>
</p><p>
<a href="Tools_UserGuides.html">UserGuides</a>
</p><p>
<a href="Tools_Utilities.html">Utilities</a>
</p><hr>
<h3>
<a name="FAQ"></a>FAQ
</h3><p>
<a href="FAQ_Common.html">Common</a>
</p><p>
<a href="FAQ_Dynamic%20Loading.html">Dynamic Loading</a>
</p><p>
<a href="FAQ_FastRPC.html">FastRPC</a>
</p><p>
<a href="FAQ_Hexagon%20IDE.html">Hexagon IDE</a>
</p><hr>
<h3>
<a name="Dependencies"></a>Dependencies
</h3><p>
<a href="Dependencies_Common.html">Common</a>
</p><hr>
<h3>
<a name="Release%20Notes"></a>Release Notes
</h3><p>
<a href="Release%20Notes_Common.html">Common</a>
</p><hr>
<h3>
<a name="Support"></a>Support
</h3><p>
<a href="Support_Contact.html">Contact</a>
</p><center><img src="images/sidebar_bot.jpg"></center></div><div id="content"><a name="_top_" style="display:block;"></a><h1>
<a name="sysMon%20DSP%20Profiler"></a>sysMon DSP Profiler
</h1><div class="toc"><div class="tocLevel"><a href="#Overview">Overview</a></div><div class="tocLevel"><a href="#Supported%20chipsets">Supported chipsets</a></div><div class="tocLevel"><a href="#Setup">Setup</a></div><div class="tocLevel"><a href="#Using%20sysMon%20DSP%20Profiler">Using sysMon DSP Profiler</a></div><div class="tocLevel"><a href="#Stats%20collection">Stats collection</a></div><div class="tocLevel"><a href="#Post-processing">Post-processing</a></div><div class="tocLevel"><a href="#Post%20processing%20script%20output%20file">Post processing script output file</a><div class="tocLevel"><a href="#Summary%20sheet">Summary sheet</a></div><div class="tocLevel"><a href="#PostProcessed%20sheet">PostProcessed sheet</a></div></div><div class="tocLevel"><a href="#Analyzing%20profiling%20data">Analyzing profiling data</a><div class="tocLevel"><a href="#_Summary%20sheet">Summary sheet</a></div><div class="tocLevel"><a href="#Post%20processed%20sheet">Post processed sheet</a></div></div><div class="tocLevel"><a href="#Illustrations">Illustrations</a><div class="tocLevel"><a href="#Gathering%20requirements">Gathering requirements</a></div><div class="tocLevel"><a href="#ADSP%20core%20clock%20-%20under%20voting%20scenario">ADSP core clock - under voting scenario</a></div><div class="tocLevel"><a href="#ADSP%20Core%20clock%20-%20Over%20voting%20scenario">ADSP Core clock - Over voting scenario</a></div><div class="tocLevel"><a href="#ADSP%20core%20clock%20-%20Ideal%20vote">ADSP core clock - Ideal vote</a></div></div></div><h2>
<a name="Overview"></a>Overview
</h2><p>
sysMon DSP Profiler is an Android UI application for profiling ADSP work load. This UI app uses FastRPC to communicate with SysMon service running on ADSP for profiling activities. The Android application can be used to profile services running on ADSP to gather information like the clocks voted for, resource usage, load distribution across available hardware threads, load on processor, bus bandwidth metrics and various other profiling metrics useful in measuring performance, debugging performance related issues and in identifying possible optimizations. This document captures steps to setup and use sysMon DSP Profiler and ways to analyze the captured profiling data.
</p><h2>
<a name="Supported%20chipsets"></a>Supported chipsets
</h2><p>
8952, 8976, 8937, 8953, 8996, 8998
</p><h2>
<a name="Setup"></a>Setup
</h2><p>
Install <b>sysMon_DSP_Profiler.apk</b> file from <code>&lt;SDK_DIR&gt;/tools/utils/sysmon/</code> SDK directory on the device connected to the host machine by running following ADB command.
</p><div class="indent"><pre>adb install sysMon_DSP_Profiler.apk
</pre></div><p>
After successful installation, <b>sysMon DSP Profiler</b> app can be found in the android App drawer as highlighted in the below screenshot.
</p><div class="indent"><left><img src="images/hp_app_drawer.png"></left></div><p>
OPTIONAL: To be done if an error pops up on opening <b>sysMon DSP Profiler</b> app from the app drawer. On some builds /dsp/ partition is not accessible from <b>sysMon DSP Profiler</b> app which may result in such errors. To allow <b>sysMon DSP Profiler</b> UI app to access <code>libsysmon_skel.so</code> part of /dsp/ partition, execute following adb commands as a work around:
</p><div class="indent"><pre>adb root
adb remount
adb shell cp /dsp/libsysmon_skel.so /system/lib/rfsa/adsp/
</pre></div><h2>
<a name="Using%20sysMon%20DSP%20Profiler"></a>Using sysMon DSP Profiler
</h2><p>
Following screenshot captures the main <b>sysMon DSP Profiler</b> application screen from where user can start, stop or clear ADSP profiling data.
</p><div class="indent"><left><img src="images/hp_main_screen.png"></left></div><p>
sysMon DSP Profiler UI provides user flexibility to choose from 2 different modes of profiling:
</p><ul type="circle">
<li>
<p>
DCVS Mode option checked
</p><p>
A fixed set of performance metrics will be monitored at sampling periods controlled by ADSP SysMon service (either 1 or 50 milli-seconds) and user cannot override the same. ADSP DCVS (if supported and enabled) logic will be active for the profiling duration and can adjust ADSP core and bus clocks dynamically.
</p>
</li><li>
<p>
DCVS Mode option un-checked
</p><p>
With DCVS Mode option un-checked user can provide a desired sampling rate in multiples of one milli-second. Profiler generates a packet at the end of every sampling rate window with the performance metrics captured in the window. ADSP DCVS (if supported) will be disabled during profiling in this mode.
</p>
</li>
</ul><p>
Once appropriate DCVS mode is selected and sampling period configured, user can start profiling ADSP for a desired use case by pressing <b>START</b> button.
</p><p>
Following screenshot captures sysMon DSP Profiler UI when started with DCVS Mode option unchecked and 1 milli-second sampling period.
</p><div class="indent"><left><img src="images/hp_ui_dcvs_uncheck.png"></left></div><p>
Following screenshot captures sysMon DSP Profiler UI when started with DCVS Mode option checked.
</p><div class="indent"><left><img src="images/hp_ui_dcvs_check.png"></left></div><p>
Performance metrics captured are post processed and published on UI continuously with a refresh rate of one second. The sysMon DSP Profiler UI publishes average and maximum values of the following performance metrics on its UI:
</p><table><tr><td><p>
<b>Metric</b>
</p></td><td><p>
<b>Description</b>
</p></td></tr><tr><td><p>
Core clock (MHz)
</p></td><td><p>
ADSP core clock in MHz
</p></td></tr><tr><td><p>
Bus clock vote (MHz)
</p></td><td><p>
Bus clock vote from ADSP in MHz
</p></td></tr><tr><td><p>
Core Utilization (%)
</p></td><td><p>
Percentage of Q6 load with respect to ADSP core clock. (Effective Q6 load / core clock) * 100
</p></td></tr><tr><td><p>
1-Thread Active (%)
</p></td><td><p>
Percentage of time ADSP core is running in single threaded mode with respect to effective Q6 load
</p></td></tr><tr><td><p>
MPPS
</p></td><td><p>
Number of packets executed by ADSP core in millions per seconds.
</p></td></tr><tr><td><p>
pCPP
</p></td><td><p>
Processor cycles per packet. (Effective Q6 load / Packets executed)
</p></td></tr><tr><td><p>
HVX Thread MPPS
</p></td><td><p>
On HVX coprocessor supported chipsets, packets executed on HVX coprocessor in millions per second
</p></td></tr><tr><td><p>
Read BW (MBps)
</p></td><td><p>
Memory read bandwidth in MBytes per second
</p></td></tr><tr><td><p>
Write BW (MBps)
</p></td><td><p>
Memory write bandwidth in MBytes per second
</p></td></tr><tr><td><p>
Total stall cycles (MCps)
</p></td><td><p>
Total cycles per second the core is waiting on Instruction/Data unit accesses.
</p></td></tr></table><p>
Detailed analysis (timeline plots and more metrics captured in user mode) is also possible with sysMon DSP Profiler saving the raw profiling data captured as a bin file on the device at <code>/sdcard/sysmon.bin</code> location. Once done with profiling, this binary file can be extracted from the device and post processed on a host machine using parser executable for detailed analysis.
</p><p>
Once started, User can stop profiling by pressing <b>STOP</b> button on the UI and metrics published on UI will remain visible till user presses <b>START</b> button again. User can also generate a detailed post processed sheet by extracting the <code>/sdcard/sysmon.bin</code> file from the device. During profiling, <b>CLEAR</b> button can be used to clear the data collected till that point of time which will reset the UI statistics and also restarts the raw profiling data <code>/sdcard/sysmon.bin</code> capture.
</p><h2>
<a name="Stats%20collection"></a>Stats collection
</h2><p>
sysMon DSP Profiler stores raw profiling data at <code>/sdcard/sysmon.bin</code> location on device. Once the user is done profiling (<b>STOP</b> button pressed), the file can be pulled from the device and post processed using sysmon parser on a host machine (Windows/Linux).
</p><p>
Command to pull the profiler output file from device using ADB:
</p><div class="indent"><pre>adb pull /sdcard/sysmon.bin &lt;destination directory&gt;\&lt;filename.bin&gt;
</pre></div><h2>
<a name="Post-processing"></a>Post-processing
</h2><p>
Post processing executable can be found at <code>&lt;SDK_DIR&gt;/tools/utils/sysmon/parser_&lt;linux\win&gt;/</code>:
</p><div class="indent"><pre>SysmonParser.exe &lt;Input file name&gt;.bin &lt;Output file name&gt; &lt;ModeType&gt; (Windows)
SysmonParser &lt;Input file name&gt;.bin &lt;Output file name&gt; &lt;ModeType&gt; (Linux)
</pre></div><table><tr><td><p>
<b>Parameter</b>
</p></td><td><p>
<b>Property</b>
</p></td><td><p>
<b>Value</b>
</p></td><td><p>
<b>Description</b>
</p></td></tr><tr><td><p>
Input file name
</p></td><td><p>
Required
</p></td><td><p>
Path to the profiler output bin file
</p><p>
(including the file name with extension)
</p><p>
extracted from the target
</p></td><td></td></tr><tr><td><p>
Output file name
</p></td><td><p>
Required
</p></td><td><p>
Desired output file path including the filename (without extension)
</p></td><td></td></tr><tr><td rowspan="2"><p>
ModeType
</p></td><td rowspan="2"><p>
Required
</p></td><td><p>
default
</p></td><td><p>
If Default mode option checked.
</p></td></tr><tr><td><p>
user
</p></td><td><p>
If Default mode option is un-checked.
</p></td></tr></table><p>
<b>Example commands:</b>
</p><div class="indent"><pre>SysmonParser sysmon.bin SysmonProfStat default
SysmonParser.exe sysmon.bin SysmonProfStat user
SysmonParser c:\temp\sysmon.bin c:\temp\SysmonProfStat user
</pre></div><h2>
<a name="Post%20processing%20script%20output%20file"></a>Post processing script output file
</h2><p>
Output of <b>SysmonParser</b> is an excel sheet saved with the name provided in <code>&lt;Output file name&gt;</code> argument. The excel sheet consists of below worksheets
</p><h3>
<a name="Summary%20sheet"></a>Summary sheet
</h3><p>
This work sheet will have the <b>AVG</b>, <b>MAX</b> and <b>MIN</b> of all the metrics captured during profiling. The overall statistics are grouped under core, bus, L1, L2 and HVX metrics. This is named as <b>Overall summary</b>.
</p><p>
Apart from publishing <b>Overall summary</b> the parser also detects ADSP core power collapse entry and exit and assumes samples between power collapse exit to entry as one test case and displays the summary of each test case.
</p><p>
Under <b>Customized Data</b> user can enter the desired start and end row (from <b>PostProcessed</b> sheet) to generate summary for the selected rows.
</p><div class="indent"><left><img src="images/hp_sample_summary_sheet.png"></left></div><h3>
<a name="PostProcessed%20sheet"></a>PostProcessed sheet
</h3><p>
This work sheet will have the post processed data of each PMU event at sampling period configured by user. Apart from the post processed PMU events, this sheet also captures NPA clock votes, ADSPPM static votes, DCVS votes for ADSP core and bus clocks in each profiling window. Also captured are heap statistics of 'GuestOS' and 'UserPDs'.
</p><div class="indent"><left><img src="images/hp_sample_postprocessed_sheet.png"></left></div><h2>
<a name="Analyzing%20profiling%20data"></a>Analyzing profiling data
</h2><h3>
<a name="_Summary%20sheet"></a>Summary sheet
</h3><p>
Overall summary section and individual test sections of this sheet helps in understanding the use case performance using the published metrics like MPPS, pCPP, AXI read and write bandwidths, clock votes etc.
</p><p>
<b>MPPS (Million packets per second):</b>
</p><p>
This metric captures the work done by the core for the given use case. Average MPPS of real time use case is constant independent of core clock. Increase in MPPS for non-real time use case for a given clock indicates effective utilization of L1 and L2 cache.
</p><p>
<b>HVX Thread MPPS (Million packets per second):</b>
</p><p>
This metric publishes the packets executed by HVX co-processor in ADSP. MPPS metrics captures both scalar core and HVX core packets. The MPPS executed on the scalar Q6 core can be calculated using:
</p><div class="indent"><pre>Q6 scalar MPPS = (MPPS - HVX Thread MPPS)
</pre></div><p>
<b>Effective Q6 frequency (MHz):</b>
</p><p>
This metric captures the actual load on the processor for the given work. Ratio of effective Q6 frequency and NPA core clock frequency can be used to get Q6 usage.
</p><div class="indent"><pre>Q6 usage percentage = (Effective Q6 frequency / NPA core clock) * 100
</pre></div><p>
The Q6 usage percentage approaching 100 indicates need for ADSP core to run at higher frequency to avoid any glitches or frame drops. MPPS and pCPP metrics together can be used to decide if the ADSP core clock vote or bus clock vote has to be adjusted in this case.
</p><p>
<b>pCPP (Processor cycles per packet):</b>
</p><p>
pCPP metric captures the average processor cycles taken per packet. Lower the pCPP factor, more is the work done in ADSP for a given core clock frequency. Core stalls due to bus accesses can result in a higher pCPP factor. Increasing the bus clock vote or prefetching data memory prior to actual usage can help in lowering this factor and hence increasing the work done for a given core clock frequency.
</p><p>
<b>IU stall frequency (MHz):</b>
</p><p>
IU stall frequency is derived from measured cycles that the core has stalled on instruction unit cache accesses due to demand misses. Higher the IU stall frequency, higher can be the pCPP factor.
</p><p>
<b>DU stall frequency (MHz):</b>
</p><p>
DU stall frequency is derived from measured cycles that the core has stalled on accessing L1 Data cache lines due to demand misses. Higher the DU stall frequency, higher can be the pCPP factor. DMT (Dynamic Multi Threading) uses DU stalls of stalled thread and schedules other threads for efficient utilization of core clock. DU stall frequency will not fully convey stall of entire processor.
</p><p>
<b>AXI cached read/write bandwidth (MBps):</b>
</p><p>
This metric publishes the AXI bus bandwidth (DDR accesses) generated by read/write access from the core due to a cache line miss in L2. This includes both demand and prefetch misses in L2 cache.
</p><p>
<b>L2 fetch bandwidth (MBps):</b>
</p><p>
Bus bandwidth generated by L2fetch instruction to prefetch data into L2 cache.
</p><p>
<b>Clock votes (MHz):</b>
</p><p>
Core clock captures core clock frequency that ADSP Q6 is running at. Bus clock vote captures overall ADSP vote for bus clock in MHz. The final bus clock frequency (done outside of ADSP) will be based on votes from other subsystems (Application processor, Modem etc.) as well.
</p><p>
<b>Static clock votes (MHz):</b>
</p><p>
Aggregated static votes from all clients for core and bus clocks.
</p><p>
<b>DCVS clock votes (MHz):</b>
</p><p>
DCVS vote for core and bus clocks.
</p><h3>
<a name="Post%20processed%20sheet"></a>Post processed sheet
</h3><p>
This sheet captures PMU metrics along with clock votes and heap statistics per profiling window. Data collected in each sample is extrapolated to per second data and published here. This sheet is especially useful in understanding the instantaneous load on ADSP and also work load distribution in a time frame.
</p><p>
Example plot of <b>Effective Q6 frequency</b> metric over time from <b>PostProcessed</b> sheet:
</p><div class="indent"><left><img src="images/hp_effec_q6_plot.png"></left></div><p>
Example of <b>Q6 load</b> plotted along with <b>core clock frequency</b> and <b>pCPP</b> over time:
</p><div class="indent"><left><img src="images/hp_q6load_plot.png"></left></div><p>
Example plot of <b>AXI bandwidth</b> over time:
</p><div class="indent"><left><img src="images/hp_axi_plot.png"></left></div><p>
Example plot of <b>MPPS</b> and <b>pCPP</b> over time:
</p><div class="indent"><left><img src="images/hp_mpps_cpp_plot.png"></left></div><h2>
<a name="Illustrations"></a>Illustrations
</h2><p>
The following sections explain ADSP clock votings with respect to usage for a periodic use case (30fps, 33 milli-seconds periodic) which implements a bilateral filter using HVX on a 1080p (1920 x 1080) resolution image. The profiling data is captured using sysMon DSP Profiler Android UI app with DCVS mode option un-checked (DCVS will remain disabled while profiling).
</p><h3>
<a name="Gathering%20requirements"></a>Gathering requirements
</h3><p>
In order to understand ADSP core and bus utilization, the use case is run with ADSP core clock and bus clock voting for maximum possible MIPS and bandwidth. The following screenshot is captured using sysMon DSP Profiler for this run:
</p><div class="indent"><left><img src="images/hp_ex_gathering_req.png"></left></div><p>
From the above data, core utilization percentage is averaged at 49% at 825.6 MHz of ADSP core clock with 390.34 MPPS. The bus read and write bandwidths combined average is around 130 MBps and core pCPP is 1.05. As the use case is periodic and have a deterministic load pattern, the MPPS load of 390.34 is what is required for this filter implementation to run at 30fps. The pCPP of 1.05 may increase if the bus clock is lowered due to increased memory access latency.
</p><p>
For a given bus clock, calculating Ideal ADSP core clock required for this use case:
</p><div class="indent"><pre style="font-size: 86%">ADSP core clock required = (MPPS * pCPP * 100) / (Intended duty cycle percentage) 
</pre></div><p>
Duty cycle percentage for this use case can be 90% i.e., the active processor time required is around 30 milli-seconds for every 33 milli-second frame. If the timeline requirement is more stringent, adjust the duty cycle requirement appropriately.
</p><p>
ADSP core clock required for this use case (at a given bus clock) = (390.34 * 1.05 * 100) / 90 = 455 MHz
</p><p>
Bus clock vote combined with ADSP Core clock decides the pCPP factor. Higher the bus clock, lower will be the DDR access latency and when combined with ideal ADSP core clock required to run the use case, lower will be the pCPP.
</p><h3>
<a name="ADSP%20core%20clock%20-%20under%20voting%20scenario"></a>ADSP core clock - under voting scenario
</h3><p>
In this run, ADSP core clock vote was 200MHz resulting in a 297.6MHz ADSP core clock frequency.
</p><div class="indent"><left><img src="images/hp_ex_undervoting.png"></left></div><p>
The core utilization percentage has jumped to 97% and measured MPPS is around 277 while the required MPPS is around 390. As ADSP core is unable to keep up with the demand, the frame deadline of 33 milli-second was not met keeping the core active all the time (97%). So, the 297.6MHz ADSP core clock is not sufficient for the use case and needs to be tuned. This matches with the estimation of 455 MHz requirement for the use case.
</p><h3>
<a name="ADSP%20Core%20clock%20-%20Over%20voting%20scenario"></a>ADSP Core clock - Over voting scenario
</h3><p>
In this run, ADSP core clock vote was 600MHz resulting in a 652.8MHz ADSP core clock frequency.
</p><div class="indent"><left><img src="images/hp_ex_overvoting.png"></left></div><p>
ADSP core is not fully utilized at this clock plan as expected. The average core utilization is around 62% at 652.8 MHz ADSP core clock. Overall MPPS requirement is met - 390 as we are running at a higher clock than required. With this data, it can be confirmed that the core clock vote in this case is high and can be lowered to 455MHz as originally calculated. Typically, higher clock frequency will result in higher power numbers measured for a given use case. If the clocks can be tuned to the ideal requirement, there would be significant power savings.
</p><h3>
<a name="ADSP%20core%20clock%20-%20Ideal%20vote"></a>ADSP core clock - Ideal vote
</h3><p>
In the following run, ADSP core clock vote is for 455MHz resulting in a 480MHz clock frequency.
</p><div class="indent"><left><img src="images/hp_ex_idealvoting.png"></left></div><p>
In this case, the MPPS requirement is met (390 MPPS) at 85% core utilization. The core clock vote looks ideal for this use case with a head room of around 70 MHz at 480 MHz.
</p><p>
The measured bus bandwidths can be used for bus bandwidth voting and can be further tuned to achieve expected pCPP and ADSP core utilization for a given core clock.
</p><p align="center" style="display:block;padding-top: 50px;">
  Copyright &#169; 2018 Qualcomm Technologies Inc. All rights reserved.

</p><a style="display:block;padding-bottom: 700px;"></a></div></div>
</body>
</html>
